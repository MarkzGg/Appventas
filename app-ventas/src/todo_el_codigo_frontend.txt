

----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\auth\AuthService.spec.ts -----

import { TestBed } from '@angular/core/testing';

import { AuthService } from './AuthService';

describe('AuthService', () => {
  let service: AuthService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(AuthService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\auth\AuthService.ts -----

import {Injectable} from '@angular/core';
import {HttpClient} from '@angular/common/http';
import {Router} from '@angular/router';
import {environment} from '../../environments/environment';
import {JwtHelperService} from '@auth0/angular-jwt';
import {Observable} from 'rxjs';


@Injectable({providedIn: 'root'})
export class AuthService {

  private readonly TOKEN_KEY = 'jwt-token';
  private readonly ROLE_KEY='jwt-role';
  private jwtHelper: JwtHelperService = new JwtHelperService(); // Instanciar

  constructor(private http: HttpClient, private router: Router) {}

  register(credentials: { username: string; password: string }): Observable<any> {
    // Asumiendo que tu backend tiene un endpoint /registro para usuarios normales
    return this.http.post(`${environment.apiUrl}/registro-comprador`, credentials, { responseType: 'text' });
  }

  getLoggedInUsername(): string | null {
        const token = this.getToken();
        if (token && !this.jwtHelper.isTokenExpired(token)) {
          const decodedToken = this.jwtHelper.decodeToken(token);
          return decodedToken.sub; // 'sub' es el campo estándar para el sujeto (username)
        }
        return null;
      }

  hasRole(roleToCheck: string): boolean {
            const userRole = this.getRole();
            return userRole === roleToCheck;
          }

  login (credentials:{username:string; password:string}) {
    return this.http.post<{token:string, role: string}>(`${environment.apiUrl}/auth/login`, credentials);
  }

  saveToken(token:string) {
    const payload=JSON.parse(atob(token.split('.')[1]));
    localStorage.setItem(this.TOKEN_KEY, token);
    localStorage.setItem(this.ROLE_KEY, payload.role);
  }

  getToken(){
    return localStorage.getItem(this.TOKEN_KEY);
  }

  getRole(){
    return localStorage.getItem(this.ROLE_KEY);
  }

   logout() {
    localStorage.removeItem(this.TOKEN_KEY);
    localStorage.removeItem(this.ROLE_KEY);
    this.router.navigate(['/login']);
  }

  isAuthenticated(): boolean {
    return !!this.getToken();
  }

  isAdmin(): boolean {
    return this.getRole()==='ADMIN';
  }

  isUser(): boolean {
    return this.getRole() === 'USER';
  }

  isComprador(): boolean {
    return this.getRole() === 'COMPRADOR';
  }

  isVisitante(): boolean {
    return this.getRole() === 'VISITANTE';
  }



}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\auth\JwtInterceptor.ts -----

import { inject } from '@angular/core';
import { HttpInterceptorFn } from '@angular/common/http';
import { AuthService } from './AuthService';

export const JwtInterceptor: HttpInterceptorFn = (req, next) => {
  const auth = inject(AuthService);
  const token = auth.getToken();
  if (token) {
    const cloned = req.clone({
      headers: req.headers.set('Authorization', `Bearer ${token}`)
    });
    return next(cloned);
  }
  return next(req);
};


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\admin\admin.component.css -----

    h2 {
      color: #333333;
      text-align: center;
      margin-top: 20px;
      margin-bottom: 30px;
    }

    .mensaje {
      color: #E53935; /* Rojo para mensajes de error */
      text-align: center;
      margin-bottom: 20px;
      padding: 10px;
      border-radius: 5px;
      font-weight: bold;
      background-color: #ffe0e0;
      border: 1px solid #ffcccc;
    }

    button {
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
      color: white;
      margin-right: 10px; /* Espacio entre botones */
    }

    button:first-of-type { /* Botón "Nuevo Producto" */
      background-color: #1E88E5; /* Azul */
    }
    button:first-of-type:hover {
      background-color: #0056b3;
    }

    button[style*="background-color: #dc3545;"] { /* Botón "Eliminar" */
      background-color: #E53935; /* Rojo */
    }
    button[style*="background-color: #dc3545;"]:hover {
      background-color: #C82333;
    }

    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background-color: #FFFFFF;
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 15px;
      border: 1px solid #eee;
      text-align: center;
      color: #333333;
    }

    th {
      background-color: #F5F5F5;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 0.9rem;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    tr:hover {
      background-color: #f1f1f1;
    }

    td button { /* Botones dentro de la tabla */
      padding: 8px 12px;
      font-size: 0.9rem;
      margin-right: 5px;
    }

    td button:not([style*="background-color"]) { /* Botón "Editar" */
      background-color: #1E88E5; /* Azul */
    }
    td button:not([style*="background-color"]):hover {
      background-color: #0056b3;
    }

    p {
      text-align: center;
      margin-top: 20px;
      color: #555;
    }
    


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\admin\admin.component.html -----

<h2>Administrar Productos</h2>

<div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

<button *ngIf="authService.isAdmin()" (click)="editarProducto(0)">Nuevo Producto</button>
<button (click)="editarProducto(0)">Nuevo Producto</button>

<table *ngIf="productos.length > 0">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Precio</th>
      <th>Stock</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let producto of productos">
      <td>{{ producto.nombre }}</td>
      <td>S/ {{ producto.precio }}</td>
      <td>{{ producto.stock }}</td>
      <td>
       <button *ngIf="authService.isUser() || authService.isAdmin()" (click)="editarProducto(producto.id!)">Editar</button>
            <!-- Botón "Eliminar": Solo visible para ADMIN -->
            <button *ngIf="authService.isAdmin()" (click)="eliminarProducto(producto.id!)">Eliminar</button>
          </td>
    </tr>
  </tbody>
</table>

<p *ngIf="productos.length === 0">No hay productos registrados.</p>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\admin\admin.component.spec.ts -----

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { AdminComponent } from './admin.component';

describe('AdminComponent', () => {
  let component: AdminComponent;
  let fixture: ComponentFixture<AdminComponent>;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [AdminComponent]
    });
    fixture = TestBed.createComponent(AdminComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\admin\admin.component.ts -----

import { UsuarioService } from 'src/app/model/usuario/usuario.service';
import { Component, OnInit } from '@angular/core';
import { Producto } from 'src/app/model/producto/producto';
import { ProductoService } from 'src/app/model/producto/producto.service';
import { Router } from '@angular/router';
import { Usuario } from 'src/app/model/usuario/usuario';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { AuthService } from 'src/app/auth/AuthService';
// Asegúrate de que este modelo exista

@Component({
  selector: 'app-admin',
  templateUrl: './admin.component.html',
  styleUrls: ['./admin.component.css'],
  standalone: true, // Asumiendo que es standalone
  imports: [
    CommonModule, // Si es necesario
    FormsModule // Si estás usando formularios
  ]
})
export class AdminComponent implements OnInit {
  productos: Producto[] = [];

  mensaje = '';

  constructor(private productoService: ProductoService, private router: Router,public authService: AuthService) {}

  ngOnInit(): void {
    this.obtenerProductos();

  }


  obtenerProductos(): void {
    this.productoService.getProductos().subscribe({
      next: (data) => this.productos = data,
      error: () => this.mensaje = 'Error al cargar productos'
    });
  }

  editarProducto(id: number): void {
        // Redirige a la ruta de creación/edición
        if (id === 0) { // Nuevo producto
          this.router.navigate(['/admin/productos/create']);
        } else { // Editar producto existente
          this.router.navigate(['/admin/productos/edit', id]);
        }
      }

  eliminarProducto(id: number): void {
        this.productoService.eliminarProducto(id).subscribe({
          next: () => this.obtenerProductos(),
          error: () => this.mensaje = 'No se pudo eliminar el producto'
        });
      }


}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\brand-management\brand-management.component.css -----

h2 {
  text-align: center;
  color: #333;
  margin-top: 20px;
  margin-bottom: 30px;
}

.mensaje {
  padding: 10px;
  margin: 10px auto;
  width: 80%;
  text-align: center;
  border-radius: 5px;
  font-weight: bold;
}

.mensaje[style*="color: red;"] {
  background-color: #ffe0e0;
  border: 1px solid #ffcccc;
  color: red;
}

.mensaje[style*="color: green;"] {
  background-color: #e0ffe0;
  border: 1px solid #ccffcc;
  color: green;
}

/* Formulario de creación/edición */
form, div.creation-form { /* Añadido div.creation-form para el formulario de creación de marca/categoría */
  display: flex;
  flex-direction: column;
  max-width: 500px;
  margin: 20px auto;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  gap: 15px;
  background-color: #fff;
}

form div, div.creation-form div {
  display: flex;
  flex-direction: column;
}

form label, div.creation-form label {
  font-weight: bold;
  margin-bottom: 5px;
  color: #333;
}

form input[type="text"],
form input[type="password"],
form input[type="number"],
form select,
div.creation-form input[type="text"] {
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
  width: 100%;
  box-sizing: border-box;
}

button {
  padding: 10px 15px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  transition: background-color 0.3s ease;
  color: white;
  background-color: #007bff; /* Color primario */
}

button:hover {
  background-color: #0056b3;
}

button[style*="background-color: #dc3545;"] { /* Estilo para botones de eliminar */
  background-color: #dc3545;
}
button[style*="background-color: #dc3545;"]:hover {
  background-color: #c82333;
}

button[style*="background-color: #28a745;"] { /* Estilo para botones de éxito/aprobar */
  background-color: #28a745;
}
button[style*="background-color: #28a745;"]:hover {
  background-color: #218838;
}

button[style*="background-color: orange;"] { /* Estilo para botones de advertencia */
  background-color: orange;
}
button[style*="background-color: orange;"]:hover {
  background-color: darkorange;
}

button[style*="background-color: gray;"] { /* Estilo para botones de cancelar */
  background-color: gray;
}
button[style*="background-color: gray;"]:hover {
  background-color: darkgray;
}

table {
  width: 90%;
  margin: 20px auto;
  border-collapse: collapse;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  background-color: #fff;
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 12px 15px;
  border: 1px solid #ddd;
  text-align: left;
}

th {
  background-color: #f2f2f2;
  font-weight: bold;
  color: #333;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}

tr:hover {
  background-color: #f1f1f1;
}

h3 {
  text-align: center;
  color: #333;
  margin-top: 20px;
  margin-bottom: 15px;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\brand-management\brand-management.component.html -----

<h2>Gestión de Marcas</h2>
<div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

<div class="creation-form"> <!-- Añadida clase para el formulario de creación -->
  <h3>Crear Nueva Marca</h3>
  <input type="text" [(ngModel)]="nuevaMarcaNombre" placeholder="Nombre de la marca" />
  <button (click)="crearMarca()">Crear</button>
</div>

<table *ngIf="marcas.length > 0">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let marca of marcas">
      <td>{{ marca.id }}</td>
      <td>{{ marca.nombre }}</td>
      <td>
        <button (click)="abrirModalEditarMarca(marca)">Editar</button>
        <button (click)="eliminarMarca(marca.id!)" style="background-color: #dc3545;">Eliminar</button>
      </td>
    </tr>
  </tbody>
</table>

<p *ngIf="marcas.length === 0">No hay marcas registradas.</p>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\brand-management\brand-management.component.ts -----

import { MarcaService } from 'src/app/model/Marca/marca.service';
import { Component, OnInit } from '@angular/core';
import { Marca } from 'src/app/model/Marca/marca';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { HttpClientModule } from '@angular/common/http';
// Importar el servicio de modales y el componente del modal de edición
// import { ModalService } from 'src/app/services/modal.service';
// import { MarcaEditModalComponent } from './marca-edit-modal/marca-edit-modal.component'; // Necesitarías crear este

@Component({
  selector: 'app-brand-management',
  templateUrl: './brand-management.component.html',
  styleUrls: ['./brand-management.component.css'],
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    HttpClientModule
  ]
})
export class BrandManagementComponent implements OnInit {
  marcas: Marca[] = [];
  nuevaMarcaNombre: string = '';
  mensaje: string = '';
  // editandoMarca: Marca | null = null; // Ya no se necesita para edición inline

  constructor(
    private marcaService: MarcaService,
    // private modalService: ModalService // Inyectar ModalService
  ) {}

  ngOnInit(): void {
    this.obtenerTodasLasMarcas();
  }

  obtenerTodasLasMarcas(): void {
    this.marcaService.getMarcas().subscribe({
      next: (data) => {
        this.marcas = data;
      },
      error: (err) => {
        console.error('Error al cargar las marcas:', err);
        this.mensaje = 'Error al cargar marcas';
      }
    });
  }

  crearMarca(): void {
    if (!this.nuevaMarcaNombre) {
      this.mensaje = 'El nombre de la marca no puede estar vacío.';
      return;
    }
    const nueva: Marca = { nombre: this.nuevaMarcaNombre };
    this.marcaService.createMarca(nueva).subscribe({
      next: () => {
        this.mensaje = 'Marca creada con éxito.';
        this.nuevaMarcaNombre = '';
        this.obtenerTodasLasMarcas();
      },
      error: (err) => this.mensaje = 'Error al crear marca: ' + (err.error || err.message)
    });
  }

  abrirModalEditarMarca(marca: Marca): void {
    // Aquí se usaría el ModalService para abrir el modal de edición
    // this.modalService.open(MarcaEditModalComponent, { marca: marca }).then(result => {
    //   if (result) { // Si el modal devuelve true (guardado)
    //     this.obtenerTodasLasMarcas();
    //   }
    // });
    // Por ahora, para simular, puedes usar un prompt o alert
    const nuevoNombre = prompt(`Editar nombre para ${marca.nombre}:`, marca.nombre);
    if (nuevoNombre !== null && nuevoNombre !== marca.nombre) {
      const marcaActualizada: Marca = { id: marca.id, nombre: nuevoNombre };
      this.marcaService.updateMarca(marca.id!, marcaActualizada).subscribe({
        next: () => {
          this.mensaje = 'Marca actualizada con éxito.';
          this.obtenerTodasLasMarcas();
        },
        error: (err) => this.mensaje = 'Error al actualizar marca: ' + (err.error || err.message)
      });
    }
  }

  eliminarMarca(id: number): void {
    if (confirm('¿Estás seguro de que quieres eliminar esta marca?')) {
      this.marcaService.deleteMarca(id).subscribe({
        next: () => {
          this.mensaje = 'Marca eliminada con éxito.';
          this.obtenerTodasLasMarcas();
        },
        error: (err) => this.mensaje = 'Error al eliminar marca: ' + (err.error || err.message)
      });
    }
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\carrito\carrito.component.css -----

h2 {
  color: #333333;
  text-align: center;
  margin-top: 20px;
  margin-bottom: 30px;
}
table {
  width: 90%; /* Aumentar el ancho de la tabla */
  margin: 0 auto 30px auto; /* Centrar y añadir margen inferior */
  border-collapse: collapse;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  background-color: #FFFFFF;
  border-radius: 8px;
  overflow: hidden; /* Para que los bordes redondeados se apliquen a la tabla */
}
th, td {
  padding: 15px; /* Aumentar el padding */
  border: 1px solid #eee; /* Bordes más suaves */
  text-align: center;
  color: #333333;
}
th {
  background-color: #F5F5F5; /* Gris claro para encabezados de tabla */
  font-weight: bold;
  text-transform: uppercase;
  font-size: 0.9rem;
}
tr:nth-child(even) {
  background-color: #f9f9f9; /* Rayas para mejor legibilidad */
}
tr:hover {
  background-color: #f1f1f1;
}
td input[type="number"] {
  width: 70px; /* Ajustar ancho del input de cantidad */
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  text-align: center;
}
.total {
  font-size: 1.5rem; /* Tamaño más grande para el total */
  font-weight: bold;
  text-align: right;
  margin-right: 5%; /* Alineado con la tabla */
  margin-bottom: 30px;
  color: #333333;
}
.cart-actions {
  display: flex;
  justify-content: center;
  gap: 20px; /* Espacio entre botones */
  margin-bottom: 40px;
}
.cart-actions button {
  padding: 12px 25px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1.1rem;
  font-weight: bold;
  transition: background-color 0.3s ease;
  color: white;
}
.cart-actions button[style*="background-color: #dc3545;"] { /* Vaciar Carrito */
  background-color: #E53935; /* Rojo */
}
.cart-actions button[style*="background-color: #dc3545;"]:hover {
  background-color: #C82333;
}
.cart-actions button[style*="background-color: #28a745;"] { /* Realizar Pedido */
  background-color: #43A047; /* Verde */
}
.cart-actions button[style*="background-color: #28a745;"]:hover {
  background-color: #218838;
}
.cart-actions button[style*="background-color: orange;"] { /* Eliminar Item */
  background-color: orange;
}
.cart-actions button[style*="background-color: orange;"]:hover {
  background-color: darkorange;
}

.mensaje {
  text-align: center;
  margin-bottom: 20px;
  padding: 10px;
  border-radius: 5px;
  font-weight: bold;
}
.mensaje[style*="color: green;"] {
  background-color: #e0ffe0;
  border: 1px solid #ccffcc;
  color: #43A047; /* Verde */
}
.mensaje[style*="color: red;"] {
  background-color: #ffe0e0;
  border: 1px solid #ffcccc;
  color: #E53935; /* Rojo */
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\carrito\carrito.component.html -----

        <h2>Mi Carrito</h2>

        <div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

        <table *ngIf="carrito.length > 0">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Precio</th>
              <th>Cantidad</th>
              <th>Subtotal</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of carrito">
              <td>{{ item.producto.nombre }}</td>
              <td>S/ {{ item.producto.precio }}</td>
              <td>
                <input type="number" [(ngModel)]="item.cantidad" min="1" (change)="actualizarCantidad(item)" style="width: 60px;">
              </td>
              <td>S/ {{ (item.producto.precio || 0) * item.cantidad }}</td>
              <td>
                <button (click)="eliminarItem(item.id!)" style="background-color: orange;">Eliminar</button>
              </td>
            </tr>
          </tbody>
        </table>

        <p *ngIf="carrito.length > 0" class="total">Total: S/ {{ getTotal() }}</p>

        <div *ngIf="carrito.length > 0" class="cart-actions"> <!-- Añadida clase para los botones -->
          <button (click)="limpiarCarrito()" style="background-color: #dc3545;">Vaciar Carrito</button>
          <button (click)="realizarPedido()" style="background-color: #28a745;">Realizar Pedido</button>
        </div>
        <p *ngIf="carrito.length === 0">Tu carrito está vacío.</p>
        


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\carrito\carrito.component.spec.ts -----

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { CarritoComponent } from './carrito.component';

describe('CarritoComponent', () => {
  let component: CarritoComponent;
  let fixture: ComponentFixture<CarritoComponent>;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [CarritoComponent]
    });
    fixture = TestBed.createComponent(CarritoComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\carrito\carrito.component.ts -----

import { BoletaService } from './../../model/boleta/boleta.service';
import { Component, OnInit } from '@angular/core';
import { CarritoService } from 'src/app/model/carrito-item/carrito.service';
import { CarritoItem } from 'src/app/model/carrito-item/carrito-item';
import { PedidoRequest } from 'src/app/model/pedido-request/pedido-request';
import { Router } from '@angular/router';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';


@Component({
  selector: 'app-carrito',
  templateUrl: './carrito.component.html',
  styleUrls: ['./carrito.component.css'],
standalone: true,
      imports: [
        CommonModule,
        FormsModule // Necesario si usas [(ngModel)] en el input de cantidad
      ]
})
export class CarritoComponent implements OnInit {
  carrito: CarritoItem[] = [];
  mensaje = '';

  constructor(
    private carritoService: CarritoService,
    private boletaService: BoletaService, // Inyectar BoletaService
    private router: Router
  ) {}

  ngOnInit(): void {
    this.obtenerCarrito();
  }

  realizarPedido(): void {
    if (this.carrito.length === 0) {
      this.mensaje = 'El carrito está vacío. No se puede realizar un pedido.';
      return;
    }
    const pedidos: PedidoRequest[] = this.carrito.map(item => ({
      productoId: item.producto?.id || 0,
      cantidad: item.cantidad
    }));
    this.carritoService.crearPedido(pedidos).subscribe({
      next: (res: any) => {
        this.mensaje = 'Pedido creado con éxito! ' + (res.message || '');
        this.boletaService.generarBoleta(pedidos).subscribe({
          next: (res2: any) => {
            this.mensaje += ' Boleta generada con éxito!';
            this.carrito = [];
            this.router.navigate(['/pedidos']);
          },
          error: (err2) => {
            console.error('Error al generar la boleta:', err2);
            this.mensaje = 'Error al generar la boleta: ' + (err2.error?.error || 'Verifique el stock o sus datos.');
          }
        });
      },
      error: (err: any) => {
        console.error('Error al crear el pedido:', err);
        this.mensaje = 'Error al crear el pedido: ' + (err.error?.error || 'Verifique el stock o sus datos.');
      }
    });
  }

  actualizarCantidad(item: CarritoItem): void {
        // Validar que la cantidad sea al menos 1
        if (item.cantidad <= 0) {
          item.cantidad = 1; // O eliminar el item si la cantidad es 0
        }
        // Como backend no soporta actualizar cantidad, solo actualizamos localmente y mostramos mensaje
        this.mensaje = `Cantidad de ${item.producto?.nombre} actualizada a ${item.cantidad} (no sincronizado con backend)`;
      }

  incrementarCantidad(item: CarritoItem): void {
        item.cantidad++;
        this.actualizarCantidad(item); // Llama al método principal de actualización
      }
      decrementarCantidad(item: CarritoItem): void {
        if (item.cantidad > 1) {
          item.cantidad--;
          this.actualizarCantidad(item); // Llama al método principal de actualización
        } else {
          // Opcional: Preguntar si desea eliminar el producto si la cantidad llega a 0
          // this.eliminarProductoDelCarrito(item);
        }
      }

  obtenerCarrito(): void {
    this.carritoService.obtenerCarrito().subscribe({
      next: (data) => this.carrito = data,
      error: () => this.mensaje = 'No se pudo cargar el carrito'
    });
  }

  limpiarCarrito(): void {
    this.carritoService.limpiarCarrito().subscribe({
      next: () => {
        this.carrito = [];
        this.mensaje = 'Carrito vaciado';
        // Redirigir a la página de productos tras vaciar carrito
        this.router.navigate(['/products']);
      },
      error: () => this.mensaje = 'Error al limpiar carrito'
    });
  }

  // realizarPedido(): void {
  //   if (this.carrito.length === 0) {
  //     this.mensaje = 'El carrito está vacío. No se puede realizar un pedido.';
  //     return;
  //   }
  //   const pedidos: PedidoRequest[] = this.carrito.map(item => ({
  //     productoId: item.producto?.id || 0,
  //     cantidad: item.cantidad
  //   }));
  //   this.boletaService.generarBoleta(pedidos).subscribe({
  //     next: (res: any) => {
  //       this.mensaje = 'Pedido realizado con éxito! ' + res;
  //       this.carrito = [];
  //       this.router.navigate(['/pedidos']);
  //     },
  //     error: (err) => {
  //       console.error('Error al realizar el pedido:', err);
  //       this.mensaje = 'Error al realizar el pedido: ' + (err.error || 'Verifique el stock o sus datos.');
  //     }
  //   });
  // }


  eliminarItem(itemId: number): void {
    // Cambiar a usar el método correcto del servicio
    this.carritoService.eliminarProducto(itemId).subscribe({
      next: () => {
        this.mensaje = 'Producto eliminado del carrito.';
        this.obtenerCarrito(); // Refrescar carrito para sincronizar
      },
      error: (err: any) => {
        console.error('Error al eliminar producto:', err);
        this.mensaje = 'Error al eliminar el producto. Intente nuevamente.';
      }
    });
  }

  getTotal(): number {
      return this.carrito.reduce((total, item) => {
        // Cambiado de item.producto?.precio a item.producto.precio
        const precio = item.producto.precio;
        // Cambiado de item.cantidad ?? 0 a item.cantidad
        const cantidad = item.cantidad;
        return total + (precio * cantidad);
      }, 0);
    }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\category-management\category-management.component.css -----

h2 {
  text-align: center;
  color: #333;
  margin-top: 20px;
  margin-bottom: 30px;
}

.mensaje {
  padding: 10px;
  margin: 10px auto;
  width: 80%;
  text-align: center;
  border-radius: 5px;
  font-weight: bold;
}

.mensaje[style*="color: red;"] {
  background-color: #ffe0e0;
  border: 1px solid #ffcccc;
  color: red;
}

.mensaje[style*="color: green;"] {
  background-color: #e0ffe0;
  border: 1px solid #ccffcc;
  color: green;
}

/* Formulario de creación/edición */
form, div.creation-form { /* Añadido div.creation-form para el formulario de creación de marca/categoría */
  display: flex;
  flex-direction: column;
  max-width: 500px;
  margin: 20px auto;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  gap: 15px;
  background-color: #fff;
}

form div, div.creation-form div {
  display: flex;
  flex-direction: column;
}

form label, div.creation-form label {
  font-weight: bold;
  margin-bottom: 5px;
  color: #333;
}

form input[type="text"],
form input[type="password"],
form input[type="number"],
form select,
div.creation-form input[type="text"] {
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
  width: 100%;
  box-sizing: border-box;
}

button {
  padding: 10px 15px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  transition: background-color 0.3s ease;
  color: white;
  background-color: #007bff; /* Color primario */
}

button:hover {
  background-color: #0056b3;
}

button[style*="background-color: #dc3545;"] { /* Estilo para botones de eliminar */
  background-color: #dc3545;
}
button[style*="background-color: #dc3545;"]:hover {
  background-color: #c82333;
}

button[style*="background-color: #28a745;"] { /* Estilo para botones de éxito/aprobar */
  background-color: #28a745;
}
button[style*="background-color: #28a745;"]:hover {
  background-color: #218838;
}

button[style*="background-color: orange;"] { /* Estilo para botones de advertencia */
  background-color: orange;
}
button[style*="background-color: orange;"]:hover {
  background-color: darkorange;
}

button[style*="background-color: gray;"] { /* Estilo para botones de cancelar */
  background-color: gray;
}
button[style*="background-color: gray;"]:hover {
  background-color: darkgray;
}

table {
  width: 90%;
  margin: 20px auto;
  border-collapse: collapse;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  background-color: #fff;
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 12px 15px;
  border: 1px solid #ddd;
  text-align: left;
}

th {
  background-color: #f2f2f2;
  font-weight: bold;
  color: #333;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}

tr:hover {
  background-color: #f1f1f1;
}

h3 {
  text-align: center;
  color: #333;
  margin-top: 20px;
  margin-bottom: 15px;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\category-management\category-management.component.html -----

<h2>Gestión de Categorías</h2>

<div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

<div class="creation-form"> <!-- Añadida clase para el formulario de creación -->
  <h3>Crear Nueva Categoría</h3>
  <input type="text" [(ngModel)]="nuevaCategoriaNombre" placeholder="Nombre de la categoría" />
  <button (click)="crearCategoria()">Crear</button>
</div>

<table *ngIf="categorias.length > 0">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let categoria of categorias">
      <td>{{ categoria.id }}</td>
      <td>
        <span *ngIf="editandoCategoria?.id !== categoria.id">{{ categoria.nombre }}</span>
        <input *ngIf="editandoCategoria && editandoCategoria.id === categoria.id"
            type="text"
            [(ngModel)]="editandoCategoria.nombre"
            name="editandoCategoriaNombre" />     </td>
      <td>
        <ng-container *ngIf="editandoCategoria?.id !== categoria.id">
          <button (click)="editarCategoria(categoria)">Editar</button>
          <button (click)="eliminarCategoria(categoria.id!)" style="background-color: #dc3545;">Eliminar</button>
        </ng-container>
        <ng-container *ngIf="editandoCategoria?.id === categoria.id">
          <button (click)="guardarEdicion()">Guardar</button>
          <button (click)="cancelarEdicion()" style="background-color: gray;">Cancelar</button>
        </ng-container>
      </td>
    </tr>
  </tbody>
</table>

<p *ngIf="categorias.length === 0">No hay categorías registradas.</p>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\category-management\category-management.component.ts -----

import { Component, OnInit } from '@angular/core';
import { Categoria } from 'src/app/model/categoria/categoria'; // Importar la interfaz Categoria
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { CategoriaService } from 'src/app/model/categoria/categoria.service'; // Importar CategoriaService
import { HttpClientModule } from '@angular/common/http'; // Necesario si es standalone y el servicio no lo provee globalmente
@Component({
  selector: 'app-category-management',
  templateUrl: './category-management.component.html',
  styleUrls: ['./category-management.component.css'],
  standalone: true, // Si es un componente standalone
  imports: [
    CommonModule, // <-- Añadir aquí
    FormsModule,   // <-- ¡Añadir aquí!
    HttpClientModule // Añadir si el componente es standalone y necesita HttpClient (aunque el servicio lo inyecta)
  ],
})
export class CategoryManagementComponent implements OnInit {
  categorias: Categoria[] = [];
  nuevaCategoriaNombre: string = '';
  mensaje: string = '';
  editandoCategoria: Categoria | null = null;
  constructor(
    private categoriaService: CategoriaService // Inyectar CategoriaService
  ) {}
ngOnInit(): void {
    this.loadCategorias();
  }
  loadCategorias(): void {
    this.categoriaService.getCategorias().subscribe({
      next: (data) => {
        this.categorias = data;
        console.log('Categorías cargadas:', this.categorias);
      },
      error: (err) => {
        console.error('Error al cargar las categorías:', err);
        this.mensaje = 'Error al cargar categorías: ' + (err.error?.message || err.message);
      }
    });
  }
  crearCategoria(): void {
    if (!this.nuevaCategoriaNombre) {
      this.mensaje = 'El nombre de la categoría no puede estar vacío.';
      return;
    }
const nueva: Categoria = { nombre: this.nuevaCategoriaNombre };
    this.categoriaService.createCategoria(nueva).subscribe({
      next: () => {
        this.mensaje = 'Categoría creada con éxito.';
        this.nuevaCategoriaNombre = '';
        this.loadCategorias();
      },
      error: (err) => this.mensaje = 'Error al crear categoría: ' + (err.error?.message || err.message)
    });
  }
  editarCategoria(categoria: Categoria): void {
    this.editandoCategoria = { ...categoria }; // Copia para no modificar el original directamente
  }
  guardarEdicion(): void {
    if (!this.editandoCategoria || !this.editandoCategoria.nombre) {
      this.mensaje = 'El nombre de la categoría no puede estar vacío.';
      return;
    }
    this.categoriaService.updateCategoria(this.editandoCategoria.id!, this.editandoCategoria).subscribe({
      next: () => {
        this.mensaje = 'Categoría actualizada con éxito.';
        this.editandoCategoria = null;
        this.loadCategorias();
      },
      error: (err) => this.mensaje = 'Error al actualizar categoría: ' + (err.error?.message || err.message)
    });
  }
cancelarEdicion(): void {
    this.editandoCategoria = null;
  }
  eliminarCategoria(id: number): void {
    if (confirm('¿Estás seguro de que quieres eliminar esta categoría?')) {
      this.categoriaService.deleteCategoria(id).subscribe({
        next: () => {
          this.mensaje = 'Categoría eliminada con éxito.';
          this.loadCategorias();
        },
        error: (err) => this.mensaje = 'Error al eliminar categoría: ' + (err.error?.message || err.message)
      });
    }
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\login\login.component.css -----

    h2 {
      color: #333333;
      text-align: center;
      margin-top: 40px;
      margin-bottom: 30px;
    }
    form {
      background-color: #FFFFFF;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 400px; /* Aumentar un poco el ancho */
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px; /* Aumentar el espacio entre elementos */
    }
    form div {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: bold;
      margin-bottom: 8px; /* Espacio entre label e input */
      color: #333333;
    }
    input {
      padding: 12px; /* Aumentar el padding */
      font-size: 1.1rem; /* Aumentar el tamaño de fuente */
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box; /* Incluir padding y border en el ancho */
    }
    button {
      padding: 12px 20px;
      background-color: #1E88E5; /* Azul para el botón de ingresar */
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0056b3;
    }
    .error {
      color: #E53935; /* Rojo para mensajes de error */
      text-align: center;
      margin-top: 20px;
      margin-bottom: 10px;
      font-weight: bold;
    }
    


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\login\login.component.html -----

<h2>Iniciar Sesión</h2>

<div *ngIf="error" class="error">{{ error }}</div>

<form (ngSubmit)="login()">
  <div>
    <label for="username">Usuario:</label>
    <input type="text" id="username" [(ngModel)]="username" name="username" required />
  </div>

  <div>
    <label for="password">Contraseña:</label>
    <input type="password" id="password" [(ngModel)]="password" name="password" required />
  </div>

  <button type="submit">Ingresar</button>
</form>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\login\login.component.spec.ts -----

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { LoginComponent } from './login.component';

describe('LoginComponent', () => {
  let component: LoginComponent;
  let fixture: ComponentFixture<LoginComponent>;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [LoginComponent]
    });
    fixture = TestBed.createComponent(LoginComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\login\login.component.ts -----

import { Component } from '@angular/core';
import { Router } from '@angular/router';
import { AuthService } from 'src/app/auth/AuthService';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';

@Component({
  selector: 'app-login',
  templateUrl: './login.component.html',
  styleUrls: ['./login.component.css'],
  standalone: true, // Asumiendo que es standalone
  imports: [
    FormsModule, // <-- Añadir aquí
    CommonModule // Si es necesario
  ]

})
export class LoginComponent {
  username = '';
  password = '';
  error = '';

  constructor(private authService: AuthService, private router: Router) {}

  login() {
  console.log('LoginComponent: Iniciando proceso de login para:', this.username);
  this.authService.login({ username: this.username, password: this.password })
    .subscribe({
      next: (res: any) => {
        console.log('LoginComponent: Login exitoso. Redirigiendo...');
        this.authService.saveToken(res.token);

        // Redirección según rol
        const role = this.authService.getRole();
        if (role === 'ROLE_ADMIN') {
          this.router.navigate(['/admin']);
        } else {
          this.router.navigate(['/products']);
        }
      },
      error: (err) => {
        console.error('LoginComponent: Error en el login:', err);
        this.error = 'Usuario o contraseña incorrectos';
        if (err.message) {
                this.error = err.message; // Mostrar el mensaje de error del servicio si está disponible
              }

      }
    });
}
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\order-management\order-management.component.css -----

h2 {
  text-align: center;
  color: #333;
  margin-top: 20px;
  margin-bottom: 30px;
}

.mensaje {
  padding: 10px;
  margin: 10px auto;
  width: 80%;
  text-align: center;
  border-radius: 5px;
  font-weight: bold;
}

.mensaje[style*="color: red;"] {
  background-color: #ffe0e0;
  border: 1px solid #ffcccc;
  color: red;
}

.mensaje[style*="color: green;"] {
  background-color: #e0ffe0;
  border: 1px solid #ccffcc;
  color: green;
}

/* Formulario de creación/edición */
form, div.creation-form { /* Añadido div.creation-form para el formulario de creación de marca/categoría */
  display: flex;
  flex-direction: column;
  max-width: 500px;
  margin: 20px auto;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  gap: 15px;
  background-color: #fff;
}

form div, div.creation-form div {
  display: flex;
  flex-direction: column;
}

form label, div.creation-form label {
  font-weight: bold;
  margin-bottom: 5px;
  color: #333;
}

form input[type="text"],
form input[type="password"],
form input[type="number"],
form select,
div.creation-form input[type="text"] {
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
  width: 100%;
  box-sizing: border-box;
}

button {
  padding: 10px 15px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  transition: background-color 0.3s ease;
  color: white;
  background-color: #007bff; /* Color primario */
}

button:hover {
  background-color: #0056b3;
}

button[style*="background-color: #dc3545;"] { /* Estilo para botones de eliminar */
  background-color: #dc3545;
}
button[style*="background-color: #dc3545;"]:hover {
  background-color: #c82333;
}

button[style*="background-color: #28a745;"] { /* Estilo para botones de éxito/aprobar */
  background-color: #28a745;
}
button[style*="background-color: #28a745;"]:hover {
  background-color: #218838;
}

button[style*="background-color: orange;"] { /* Estilo para botones de advertencia */
  background-color: orange;
}
button[style*="background-color: orange;"]:hover {
  background-color: darkorange;
}

button[style*="background-color: gray;"] { /* Estilo para botones de cancelar */
  background-color: gray;
}
button[style*="background-color: gray;"]:hover {
  background-color: darkgray;
}

table {
  width: 90%;
  margin: 20px auto;
  border-collapse: collapse;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  background-color: #fff;
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 12px 15px;
  border: 1px solid #ddd;
  text-align: left;
}

th {
  background-color: #f2f2f2;
  font-weight: bold;
  color: #333;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}

tr:hover {
  background-color: #f1f1f1;
}

h3 {
  text-align: center;
  color: #333;
  margin-top: 20px;
  margin-bottom: 15px;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\order-management\order-management.component.html -----

<h2>Gestión de Pedidos</h2>

<div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

<div *ngFor="let pedido of pedidos" class="pedido-card">
  <h3>Boleta #{{ pedido.numeroBoleta }} - Fecha: {{ pedido.fechaEmision | date:'short' }}</h3>
  <p>Usuario: {{ pedido.usuario?.username || 'N/A' }}</p> <!-- Asumiendo que Boleta tiene usuario -->
  <p>Total: S/ {{ pedido.total | number:'1.2-2' }}</p>

  <button (click)="abrirModalDetallePedido(pedido)">Ver Detalle Completo</button>
  <!-- Actualizar estado solo si es ADMIN -->
  <select *ngIf="authService.isAdmin()" (change)="actualizarEstado(pedido.id!, $event)">
    <option value="">Actualizar Estado</option>
    <option value="PENDIENTE">PENDIENTE</option>
    <option value="EN_PROCESO">EN PROCESO</option>
    <option value="ENVIADO">ENVIADO</option>
    <option value="ENTREGADO">ENTREGADO</option>
    <option value="CANCELADO">CANCELADO</option>
  </select>
</div>

<p *ngIf="pedidos.length === 0">No hay pedidos para gestionar.</p>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\order-management\order-management.component.ts -----

    import { Component, OnInit } from '@angular/core';
    import { Boleta } from 'src/app/model/boleta/boleta';
    import { BoletaService } from 'src/app/model/boleta/boleta.service';
    import { AuthService } from 'src/app/auth/AuthService';
    import { CommonModule, DatePipe, DecimalPipe } from '@angular/common';
    import { FormsModule } from '@angular/forms';
    // import { ModalService } from 'src/app/services/modal.service';
    // import { OrderDetailModalComponent } from './order-detail-modal/order-detail-modal.component';

    @Component({
      selector: 'app-order-management',
      templateUrl: './order-management.component.html',
      styleUrls: ['./order-management.component.css'],
      standalone: true,
      imports: [CommonModule, FormsModule, DatePipe, DecimalPipe]
    })
    export class OrderManagementComponent implements OnInit {
      pedidos: Boleta[] = [];
      mensaje: string = '';

      constructor(
        private boletaService: BoletaService,
        public authService: AuthService,
        // private modalService: ModalService
      ) {}

      ngOnInit(): void {
        this.loadAllOrders();
      }

      loadAllOrders(): void {
        // Necesitas un endpoint en el backend para que ADMIN vea todas las boletas
        // Tu BoletaRepository tiene findByUsuario, pero no un findAll para ADMIN
        // Si no tienes un endpoint getAllBoletas en el backend, este método no funcionará como se espera para ADMIN
        // Por ahora, usaremos obtenerHistorial() que es para el usuario logueado, lo cual no es correcto para gestión.
        // Asumiendo que el backend tiene un endpoint para ADMIN como /boletas/all
        // this.boletaService.getAllBoletasForAdmin().subscribe({
        this.boletaService.obtenerHistorial().subscribe({ // TEMPORAL: Esto solo carga las del usuario logueado
          next: (data) => this.pedidos = data,
          error: (err) => this.mensaje = 'Error al cargar pedidos: ' + (err.error || err.message)
        });
      }

      abrirModalDetallePedido(pedido: Boleta): void {
        // this.modalService.open(OrderDetailModalComponent, { pedido: pedido });
        alert('Funcionalidad de ver detalle de pedido no implementada aún. Detalles en consola.');
        console.log('Detalle del Pedido:', pedido);
      }

      actualizarEstado(pedidoId: number, event: Event): void {
        const selectElement = event.target as HTMLSelectElement;
    const nuevoEstado = selectElement.value;
        // Necesitas un endpoint en el backend para actualizar el estado de la boleta
        // this.boletaService.updateBoletaStatus(pedidoId, nuevoEstado).subscribe({
        //   next: () => {
        //     this.mensaje = 'Estado del pedido actualizado.';
        //     this.loadAllOrders();
        //   },
        //   error: (err) => this.mensaje = 'Error al actualizar estado: ' + (err.error || err.message)
        // });
        alert(`Funcionalidad de actualizar estado del pedido ${pedidoId} a ${nuevoEstado} no implementada aún.`);
      }
    }


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\pedidos\boleta-pdf-modal.component.css -----

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background-color: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  width: 90%; /* Ajusta el tamaño según necesites */
  max-width: 600px;
  max-height: 90%;
  overflow-y: auto;
}

.large-modal-content {
    max-width: 900px; /* Para el modal del PDF que necesita más espacio */
}

.pdf-viewer-container {
    margin-top: 20px;
    border: 1px solid #ccc;
    height: 500px; /* Altura fija para el iframe */
    overflow: hidden; /* Asegura que el iframe no desborde */
}

.modal-actions {
  margin-top: 20px;
  text-align: right;
}

.modal-actions button {
  padding: 10px 15px;
  margin-left: 10px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  background-color: #007bff;
  color: white;
}

.modal-actions button:hover {
  background-color: #0056b3;
}

.loading-message, .error-message {
    text-align: center;
    padding: 15px;
    margin-top: 20px;
    border-radius: 5px;
}

.loading-message {
    background-color: #e0f7fa;
    color: #00796b;
}

.error-message {
    background-color: #ffe0e0;
    color: #d32f2f;
    border: 1px solid #d32f2f;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\pedidos\boleta-pdf-modal.component.html -----

<div class="modal-overlay" *ngIf="pedido">
  <div class="modal-content large-modal-content"> <h2>Vista Previa de Boleta - {{ pedido.numeroBoleta }}</h2>

    <div *ngIf="loadingPdf" class="loading-message">Cargando PDF...</div>
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

    <div class="pdf-viewer-container" *ngIf="pdfUrl && !loadingPdf">
      <iframe [src]="pdfUrl" width="100%" height="500px"></iframe>
    </div>

    <div class="modal-actions">
      <button (click)="cerrarModal()">Cerrar</button>
      <button (click)="descargarBoletaPdf()">Descargar Boleta PDF</button>
    </div>
  </div>
</div>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\pedidos\boleta-pdf-modal.component.ts -----

import { Component, Input, Output, EventEmitter, OnChanges, SimpleChanges } from '@angular/core';
import { CommonModule } from '@angular/common';
import { BoletaService } from 'src/app/model/boleta/boleta.service';
import { Boleta } from 'src/app/model/boleta/boleta';
import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';


@Component({
  selector: 'app-boleta-pdf-modal',
  templateUrl: './boleta-pdf-modal.component.html',
  styleUrls: ['./boleta-pdf-modal.component.css'],
  standalone: true,
  imports: [CommonModule]
})
export class BoletaPdfModalComponent implements OnChanges {
  @Input() pedido: Boleta | null = null;
  @Output() onClose = new EventEmitter<void>(); // Evento para cerrar este modal

  pdfUrl: SafeResourceUrl | null = null;
  loadingPdf: boolean = false;
  errorMessage: string = '';


  constructor(
    private boletaService: BoletaService,
    private sanitizer: DomSanitizer // Para sanitizar la URL del PDF
  ) {}

  // Este método se ejecuta cuando las propiedades de entrada cambian
  ngOnChanges(changes: SimpleChanges): void {
    if (changes['pedido'] && this.pedido && this.pedido.id) {
      this.cargarYMostrarPdf(this.pedido.id);
    } else if (changes['pedido'] && !this.pedido) {
      this.pdfUrl = null; // Limpiar si el pedido es nulo
      this.errorMessage = '';
    }
  }

  cargarYMostrarPdf(pedidoId: number): void {
    this.loadingPdf = true;
    this.errorMessage = '';
    this.pdfUrl = null;

    this.boletaService.descargarBoletaPdf(pedidoId).subscribe({
      next: (response: Blob) => {
        const url = URL.createObjectURL(response);
        this.pdfUrl = this.sanitizer.bypassSecurityTrustResourceUrl(url);
        this.loadingPdf = false;
        // No revocar aquí, el iframe lo necesita. Se revoca al cerrar el modal padre o destruir el componente si es necesario.
      },
      error: (err) => {
        console.error('Error al cargar PDF para visualización:', err);
        this.errorMessage = 'No se pudo cargar la vista previa del PDF: ' + (err.error?.message || err.message || 'Error desconocido');
        this.loadingPdf = false;
        this.pdfUrl = null;
      }
    });
  }

  descargarBoletaPdf(): void {
    if (this.pedido && this.pedido.id) {
      console.log(`Descargando PDF para la boleta con ID: ${this.pedido.id}`);
      this.boletaService.descargarBoletaPdf(this.pedido.id).subscribe({
        next: (response: Blob) => {
          const url = window.URL.createObjectURL(response);
          const a = document.createElement('a');
          a.href = url;
          a.download = `boleta_pedido_${this.pedido!.id}.pdf`;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
        },
        error: (err) => {
          console.error('Error al descargar PDF:', err);
          this.errorMessage = 'Error al descargar el PDF de la boleta: ' + (err.error?.error || 'Intente nuevamente.');
        }
      });
    } else {
      this.errorMessage = 'No se encontró ID para descargar la boleta.';
    }
  }

  cerrarModal(): void {
    if (this.pdfUrl) {
      // Es importante revocar el Object URL cuando ya no se necesita
      // para liberar memoria.
      URL.revokeObjectURL(this.pdfUrl.toString().split(' ').pop() || ''); // Extrae la URL real
    }
    this.onClose.emit(); // Emite el evento para que el padre cierre el modal
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\pedidos\order-detail-modal.component.css -----

/* Asegúrate de que tus estilos CSS usen .modal-overlay en lugar de .modal-backdrop */
.modal-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 1000; /* Asegura que esté por encima de otros elementos */
  display: flex; /* Para centrar el modal-content */
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: white;
  padding: 20px;
  z-index: 1001; /* Debe ser mayor que el overlay */
  max-width: 600px;
  width: 90%;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  /* Si usaste transform: translate(-50%, -50%); antes, con display: flex en el overlay ya no es estrictamente necesario,
     pero no hace daño si lo tenías. */
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\pedidos\order-detail-modal.component.html -----

<div class="modal-overlay" *ngIf="pedido">
  <div class="modal-content">
    <h2>Detalle del Pedido - Boleta {{ pedido.numeroBoleta }}</h2>
    <p>Fecha: {{ pedido.fechaEmision | date:'short' }}</p>

    <table>
      <thead>
        <tr>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Precio Unitario</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let detalle of pedido.detalles">
          <td>{{ detalle.producto }}</td>
          <td>{{ detalle.cantidad }}</td>
          <td>S/ {{ detalle.precioUnitario | number:'1.2-2' }}</td>
          <td>S/ {{ detalle.subtotalDetalle | number:'1.2-2' }}</td>
        </tr>
      </tbody>
    </table>

    <div class="summary">
      <p>Subtotal: S/ {{ pedido.subtotal | number:'1.2-2' }}</p>
      <p>IGV (18%): S/ {{ pedido.igv | number:'1.2-2' }}</p>
      <h3>Total: S/ {{ pedido.total | number:'1.2-2' }}</h3>
    </div>

    <div class="modal-actions">
      <button (click)="cerrarModal()">Cerrar</button>
      </div>
  </div>
</div>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\pedidos\order-detail-modal.component.ts -----

import { Component, Input, Output, EventEmitter } from '@angular/core';
import { Boleta } from 'src/app/model/boleta/boleta';
import { CommonModule, DatePipe, DecimalPipe } from '@angular/common';
import { BoletaService } from 'src/app/model/boleta/boleta.service'; // Importa el servicio de boletas
import { DomSanitizer } from '@angular/platform-browser'; // Importa DomSanitizer

@Component({
  selector: 'app-order-detail-modal',
  template: `
    <div class="modal-overlay" (click)="cerrarModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>Detalle del Pedido - Boleta {{ pedido?.numeroBoleta }}</h2>
        <p>Fecha: {{ pedido?.fechaEmision | date:'short' }}</p>
        <table>
          <thead>
            <tr>
              <th>Producto</th>
              <th>Cantidad</th>
              <th>Precio Unitario</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let detalle of pedido?.detalles">
              <td>{{ detalle.producto }}</td>
              <td>{{ detalle.cantidad }}</td>
              <td>S/ {{ detalle.precioUnitario | number:'1.2-2' }}</td>
              <td>S/ {{ detalle.subtotalDetalle | number:'1.2-2' }}</td>
            </tr>
          </tbody>
        </table>
        <p>Subtotal: S/ {{ pedido?.subtotal | number:'1.2-2' }}</p>
        <p>IGV (18%): S/ {{ pedido?.igv | number:'1.2-2' }}</p>
        <p>Total: S/ {{ pedido?.total | number:'1.2-2' }}</p>
        <div class="modal-actions">
          <button (click)="cerrarModal()">Cerrar</button>
          <button (click)="descargarBoletaPdf()">Descargar Boleta PDF</button> </div>
      </div>
    </div>
  `,
  styles: [`
    /* Tus estilos CSS existentes para .modal-overlay y .modal-content */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      z-index: 1001;
      max-width: 600px;
      width: 90%;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      max-height: 90vh; /* Para que el contenido sea scrollable si es muy largo */
      overflow-y: auto; /* Para que el contenido sea scrollable si es muy largo */
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .modal-actions {
        margin-top: 20px;
        text-align: right;
    }
    .modal-actions button {
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background-color: #6c757d;
        color: white;
        transition: background-color 0.2s ease;
    }
    .modal-actions button:hover {
        background-color: #5a6268;
    }
    /* Estilo específico para el botón de descarga */
    .modal-actions button:nth-child(2) { /* Selecciona el segundo botón (Descargar) */
        background-color: #007bff; /* Azul */
        margin-left: 10px;
    }
    .modal-actions button:nth-child(2):hover {
        background-color: #0056b3;
    }
  `],
  standalone: true,
  imports: [CommonModule, DatePipe, DecimalPipe]
})
export class OrderDetailModalComponent {
  @Input() pedido?: Boleta;
  @Input() onClose!: () => void;

  constructor(
    private boletaService: BoletaService, // Inyecta el servicio
    private sanitizer: DomSanitizer // Inyecta DomSanitizer
  ) { }

  cerrarModal(): void {
    console.log('OrderDetailModalComponent: Se hizo clic en Cerrar.');
    if (this.onClose) {
      this.onClose();
      console.log('OrderDetailModalComponent: Ejecutando onClose del padre.');
    } else {
      console.warn('OrderDetailModalComponent: onClose no está definido.');
    }
  }

  descargarBoletaPdf(): void {
    if (this.pedido && this.pedido.id) { // Asegúrate de que 'pedido' y 'pedido.id' existan
      console.log(`Solicitando descarga de PDF para la boleta con ID: ${this.pedido.id}`);
      this.boletaService.descargarBoletaPdf(this.pedido.id).subscribe({
        next: (response: Blob) => {
          // Crea una URL de objeto temporal para el Blob
          const url = window.URL.createObjectURL(response);
          const a = document.createElement('a'); // Crea un elemento 'a' para la descarga
          a.href = url; // Establece el href a la URL del Blob
          a.download = `boleta_pedido_${this.pedido!.numeroBoleta || this.pedido!.id}.pdf`; // Nombre del archivo, usa numeroBoleta si está disponible
          document.body.appendChild(a); // Añade el 'a' al cuerpo del documento (invisible)
          a.click(); // Simula un clic para iniciar la descarga
          document.body.removeChild(a); // Elimina el elemento 'a'
          window.URL.revokeObjectURL(url); // Libera la URL del objeto para liberar memoria
          console.log('PDF de boleta descargado con éxito.');
        },
        error: (err) => {
          console.error('Error al descargar PDF:', err);
          // Muestra un mensaje al usuario
          alert('Error al descargar el PDF de la boleta: ' + (err.error?.message || 'Intente nuevamente.'));
        }
      });
    } else {
      alert('No se puede descargar la boleta: ID del pedido no disponible.');
    }
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\pedidos\pedidos.component.css -----

    h2 {
      color: #333333;
      text-align: center;
      margin-top: 20px;
      margin-bottom: 30px;
    }
    .pedido-card {
      background-color: #FFFFFF;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 25px;
      margin-bottom: 25px;
      color: #333333;
    }
    .pedido-card h3 {
      color: #1E88E5; /* Azul para el número de boleta */
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 1.4rem;
    }
    .pedido-card p {
      margin-bottom: 8px;
      font-size: 1.1rem;
    }
    .pedido-card h4 {
      margin-top: 25px;
      margin-bottom: 15px;
      color: #333333;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }
    .pedido-card table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .pedido-card th,
    .pedido-card td {
      padding: 12px;
      border: 1px solid #eee;
      text-align: left;
      font-size: 0.95rem;
    }
    .pedido-card th {
      background-color: #F5F5F5;
      font-weight: bold;
    }
    .pedido-card tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .pedido-card button {
      background-color: #1E88E5; /* Azul para el botón de ver detalle */
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 20px;
      transition: background-color 0.3s ease;
    }
    .pedido-card button:hover {
      background-color: #0056b3;
    }
    .mensaje {
      text-align: center;
      margin-bottom: 20px;
      padding: 10px;
      border-radius: 5px;
      font-weight: bold;
      background-color: #ffe0e0;
      border: 1px solid #ffcccc;
      color: #E53935; /* Rojo */
    }
    


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\pedidos\pedidos.component.html -----

<h2>Historial de Pedidos</h2>

<div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

<div *ngFor="let pedido of pedidos" class="pedido-card">
  <h3>Boleta #{{ pedido.numeroBoleta }} - Fecha: {{ pedido.fechaEmision | date:'short' }}</h3>
  <p>Subtotal: S/ {{ pedido.subtotal | number:'1.2-2' }}</p>
  <p>IGV: S/ {{ pedido.igv | number:'1.2-2' }}</p>
  <p>Total: S/ {{ pedido.total | number:'1.2-2' }}</p>

  <h4>Detalles del Pedido:</h4>
  <table>
    <thead>
      <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Precio Unitario</th>
        <th>Subtotal Detalle</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let detalle of pedido.detalles">
        <td>{{ detalle.producto }}</td>
        <td>{{ detalle.cantidad }}</td>
        <td>S/ {{ detalle.precioUnitario | number:'1.2-2' }}</td>
        <td>S/ {{ detalle.subtotalDetalle | number:'1.2-2' }}</td>
      </tr>
    </tbody>
  </table>
  <div class="pedido-actions">
    <button (click)="abrirModalDetallePedido(pedido)">Ver Detalle Completo</button>
    </div>
</div>

<app-order-detail-modal
  *ngIf="showDetailModal && selectedPedido"
  [pedido]="selectedPedido"
  [onClose]="cerrarModalDetalle"
></app-order-detail-modal>

<p *ngIf="pedidos.length === 0 && !mensaje">No hay pedidos registrados.</p>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\pedidos\pedidos.component.spec.ts -----

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { PedidosComponent } from './pedidos.component';

describe('PedidosComponent', () => {
  let component: PedidosComponent;
  let fixture: ComponentFixture<PedidosComponent>;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [PedidosComponent]
    });
    fixture = TestBed.createComponent(PedidosComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\pedidos\pedidos.component.ts -----

import { Component, OnInit } from '@angular/core';
import { PedidoService } from 'src/app/model/pedido/pedido.service';
import { CommonModule, DatePipe, DecimalPipe } from '@angular/common';
import { OrderDetailModalComponent } from './order-detail-modal.component'; // Mantener este
import { Boleta } from 'src/app/model/boleta/boleta';
// import { BoletaPdfModalComponent } from './boleta-pdf-modal.component'; // ¡ELIMINAR esta importación!

@Component({
  selector: 'app-pedidos',
  templateUrl: './pedidos.component.html',
  styleUrls: ['./pedidos.component.css'],
  standalone: true,
  imports: [CommonModule, DatePipe, DecimalPipe, OrderDetailModalComponent] // Eliminar BoletaPdfModalComponent
})
export class PedidosComponent implements OnInit {
  pedidos: any[] = [];
  mensaje = '';
  // showModal = false; // Eliminar si no se usa
  showDetailModal = false;
  // showPdfModal = false; // ELIMINAR si no se usa
  selectedPedido: Boleta | null = null;

  constructor(private pedidoService: PedidoService /*, private boletaService: BoletaService*/) {} // ELIMINAR BoletaService si ya no lo usas aquí

  ngOnInit(): void {
    this.pedidoService.obtenerHistorial().subscribe({
      next: (data: any[]) => this.pedidos = data,
      error: () => this.mensaje = 'No se pudo cargar el historial de pedidos'
    });
  }

  // Si 'cerrarModal()' y 'descargarBoletaPdf()' no se usan en PedidosComponent directamente, eliminarlos
  // cerrarModal(): void { /* ... */ }
  // descargarBoletaPdf(pedido: Boleta): void { /* ... */ }
  // generarBoleta(pedido: any): void { /* ... */ }


  abrirModalDetallePedido(pedido: Boleta): void {
    this.selectedPedido = pedido;
    this.showDetailModal = true;
    console.log('Estructura de selectedPedido:', JSON.stringify(this.selectedPedido, null, 2));
    console.log('PEDIDOS COMPONENT: Abrir modal. showDetailModal:', this.showDetailModal, 'selectedPedido:', this.selectedPedido);
  }

  cerrarModalDetalle = () => {
    this.showDetailModal = false;
    this.selectedPedido = null;
    console.log('PedidosComponent: Cerrando modal de detalle desde el padre. showDetailModal:', this.showDetailModal);
  };

  // ELIMINAR estos métodos si ya no abres un modal de PDF separado
  // abrirModalPdfBoleta(pedido: Boleta): void { /* ... */ }
  // cerrarModalPdfBoleta(): void { /* ... */ }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\perfil\perfil.component.css -----

h2 {
  color: #333333;
  text-align: center;
  margin-top: 40px;
  margin-bottom: 30px;
}
form {
  background-color: #FFFFFF;
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  max-width: 500px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 20px;
}
form div {
  display: flex;
  flex-direction: column;
}
label {
  font-weight: bold;
  margin-bottom: 8px;
  color: #333333;
}
input {
  padding: 12px;
  font-size: 1.1rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}
input[readonly] {
  background-color: #F5F5F5; /* Gris claro para campos de solo lectura */
  color: #888;
  cursor: not-allowed;
}
button {
  padding: 12px 20px;
  background-color: #1E88E5; /* Azul para el botón de actualizar */
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1.1rem;
  font-weight: bold;
  transition: background-color 0.3s ease;
}
button:hover {
  background-color: #0056b3;
}
.mensaje {
  text-align: center;
  margin-bottom: 20px;
  padding: 10px;
  border-radius: 5px;
  font-weight: bold;
  background-color: #e0ffe0;
  border: 1px solid #ccffcc;
  color: #43A047; /* Verde */
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\perfil\perfil.component.html -----

<h2>Mi Perfil</h2>

<div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

<form (ngSubmit)="actualizarPerfil()">
  <div>
    <label for="username">Usuario:</label>
    <input type="text" id="username" [(ngModel)]="usuario.username" name="username" readonly />
  </div>

  <div>
    <label for="nombre">Nombre completo:</label>
    <input type="text" id="nombre" [(ngModel)]="usuario.nombre" name="nombreCompleto" required />
  </div>

  <div>
    <label for="direccion">Dirección:</label>
    <input type="text" id="direccion" [(ngModel)]="usuario.direccion" name="direccion" required />
  </div>

  <div>
    <label for="telefono">Teléfono:</label>
    <input type="text" id="telefono" [(ngModel)]="usuario.telefono" name="telefono" required />
  </div>

  <button type="submit">Actualizar</button>
</form>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\perfil\perfil.component.spec.ts -----

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { PerfilComponent } from './perfil.component';

describe('PerfilComponent', () => {
  let component: PerfilComponent;
  let fixture: ComponentFixture<PerfilComponent>;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [PerfilComponent]
    });
    fixture = TestBed.createComponent(PerfilComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\perfil\perfil.component.ts -----

import { Component, OnInit } from '@angular/core';
import { Usuario } from 'src/app/model/usuario/usuario';
import { UsuarioService } from 'src/app/model/usuario/usuario.service';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms'; // Importa FormsModule para manejar formularios

@Component({
  selector: 'app-perfil',
  templateUrl: './perfil.component.html',
  styleUrls: ['./perfil.component.css'],
  standalone: true, // Si es un componente standalone
  imports: [
    CommonModule, // <-- Añadir aquí
    FormsModule   // <-- ¡Añadir aquí!
  ],
})
export class PerfilComponent implements OnInit {
  usuario: Usuario = {
    username: '',
    nombre: '',
    direccion: '',
    telefono: ''
  };

  mensaje = '';

  constructor(private usuarioService: UsuarioService) {}

  ngOnInit(): void {
    this.usuarioService.obtenerPerfil().subscribe({
      next: (data) => this.usuario = data,
      error: () => this.mensaje = 'No se pudo cargar el perfil'
    });
  }

  actualizarPerfil(): void {
    this.usuarioService.actualizarPerfil(this.usuario).subscribe({
      next: () => this.mensaje = 'Perfil actualizado con éxito',
      error: () => this.mensaje = 'Error al actualizar perfil'
    });
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\product-form\product-form.component.css -----

form {
  display: flex;
  flex-direction: column;
  max-width: 400px;
  margin: 0 auto;
  gap: 1rem;
}

label {
  font-weight: bold;
}

input {
  padding: 8px;
  font-size: 1rem;
}

button {
  padding: 10px;
  background-color: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  background-color: #0056b3;
}

.mensaje {
  color: red;
  text-align: center;
  margin-bottom: 1rem;
}
    h2 {
      color: #333333;
      text-align: center;
      margin-top: 20px;
      margin-bottom: 30px;
    }

    form {
      background-color: #FFFFFF;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    form div {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: bold;
      margin-bottom: 8px;
      color: #333333;
    }

    input, select {
      padding: 12px;
      font-size: 1.1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button {
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      transition: background-color 0.3s ease;
      color: white;
      margin-top: 10px; /* Espacio superior para los botones */
    }

    button[type="submit"] {
      background-color: #1E88E5; /* Azul para guardar */
    }
    button[type="submit"]:hover {
      background-color: #0056b3;
    }

    button[style*="background-color: gray;"] { /* Botón cancelar */
      background-color: gray;
    }
    button[style*="background-color: gray;"]:hover {
      background-color: darkgray;
    }

    .mensaje {
      color: #E53935; /* Rojo para mensajes de error */
      text-align: center;
      margin-bottom: 20px;
      padding: 10px;
      border-radius: 5px;
      font-weight: bold;
      background-color: #ffe0e0;
      border: 1px solid #ffcccc;
    }
      


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\product-form\product-form.component.html -----

        <h2>{{ editando ? 'Editar' : 'Nuevo' }} Producto</h2>

        <div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

        <form (ngSubmit)="guardar()">
          <div>
            <label for="nombre">Nombre:</label>
            <input id="nombre" [(ngModel)]="producto.nombre" name="nombre" required />
          </div>

          <div>
            <label for="descripcion">Descripción:</label>
            <input id="descripcion" [(ngModel)]="producto.descripcion" name="descripcion" required />
          </div>

          <div>
            <label for="precio">Precio:</label>
            <input type="number" id="precio" [(ngModel)]="producto.precio" name="precio" required min="0" />
          </div>

          <div>
            <label for="stock">Stock:</label>
            <input type="number" id="stock" [(ngModel)]="producto.stock" name="stock" required min="0" />
          </div>

          <div>
        <label for="marca">Marca:</label>
        <select id="marca" [(ngModel)]="producto.marca!.id" name="marca">
          <option [ngValue]="undefined">-- Seleccione una Marca --</option>
          <option *ngFor="let marca of marcas" [ngValue]="marca.id">{{ marca.nombre }}</option>
        </select>
      </div>
      <!-- Select para Categoría -->
      <div>
        <label for="categoria">Categoría:</label>
        <select id="categoria" [(ngModel)]="producto.categoria!.id" name="categoria">
          <option [ngValue]="undefined">-- Seleccione una Categoría --</option>
          <option *ngFor="let categoria of categorias" [ngValue]="categoria.id">{{ categoria.nombre }}</option>
        </select>
      </div>

          <button type="submit">Guardar</button>
          <button type="button" (click)="cancelar()" style="background-color: gray;">Cancelar</button>
        </form>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\product-form\product-form.component.spec.ts -----

import { ComponentFixture, TestBed } from '@angular/core/testing';


import { ProductFormComponent } from './product-form.component';

describe('ProductFormComponent', () => {
  let component: ProductFormComponent;
  let fixture: ComponentFixture<ProductFormComponent>;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [ProductFormComponent]
    });
    fixture = TestBed.createComponent(ProductFormComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\product-form\product-form.component.ts -----

import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core'; // Importar Input, Output, EventEmitter
import { ActivatedRoute, Router } from '@angular/router';
import { Producto } from 'src/app/model/producto/producto';
import { ProductoService } from 'src/app/model/producto/producto.service';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { AuthService } from 'src/app/auth/AuthService';
import { MarcaService } from 'src/app/model/Marca/marca.service'; // Importar MarcaService
import { CategoriaService } from 'src/app/model/categoria/categoria.service';// Importar CategoriaService
import { Marca } from 'src/app/model/Marca/marca';
import { Categoria } from 'src/app/model/categoria/categoria';

@Component({
  selector: 'app-product-form',
  templateUrl: './product-form.component.html',
  styleUrls: ['./product-form.component.css'],
  standalone: true,
  imports: [
    CommonModule,
    FormsModule
  ],
})
export class ProductFormComponent implements OnInit {
  @Input() productId: number | null = null; // Para recibir el ID si es edición (cuando se usa como modal)
  @Output() productSaved = new EventEmitter<boolean>(); // Para notificar al padre que se guardó
  @Output() cancelEdit = new EventEmitter<void>(); // Para notificar al padre que se canceló

  producto: Producto = {
    nombre: '',
    descripcion: '',
    precio: 0,
    stock: 0,
    marca: {id: undefined, nombre: '' }, // Inicializar para evitar errores de acceso
    categoria: { id: undefined, nombre: ''} // Inicializar
  };
  mensaje = '';
  editando = false;
  marcas: Marca[] = [];
  categorias: Categoria[] = [];

  constructor(
    private productoService: ProductoService,
    private route: ActivatedRoute,
    private router: Router,
    private authService: AuthService,
    private marcaService: MarcaService, // Inyectar
    private categoriaService: CategoriaService // Inyectar
  ) {}

  ngOnInit(): void {
    this.loadMarcas();
    this.loadCategorias();

    // Lógica para cargar producto si es edición (desde ruta o Input)
    const idFromRoute = this.route.snapshot.paramMap.get('id');
    const idToLoad = this.productId || (idFromRoute ? Number(idFromRoute) : null);

    if (idToLoad) {
      this.editando = true;
      this.productoService.getProducto(idToLoad).subscribe({
        next: (data) => {
          this.producto = data;
          // Asegurar que los IDs de marca/categoría estén en el modelo para el select
          if (this.producto.marca) {
            this.producto.marca.id = this.producto.marca.id;
          }
          if (this.producto.categoria) {
            this.producto.categoria.id = this.producto.categoria.id;
          }
        },
        error: () => this.mensaje = 'No se pudo cargar el producto'
      });
    }
  }

  loadMarcas(): void {
    this.marcaService.getMarcas().subscribe({
      next: (data) => this.marcas = data,
      error: (err) => console.error('Error al cargar marcas:', err)
    });
  }

  loadCategorias(): void {
    this.categoriaService.getCategorias().subscribe({
      next: (data) => this.categorias = data,
      error: (err) => console.error('Error al cargar categorías:', err)
    });
  }

  guardar(): void {
    // Validar permisos (aunque los guards de ruta ya lo hacen, es una capa extra)
    if (this.editando && !(this.authService.isUser() || this.authService.isAdmin())) {
      this.mensaje = 'No tienes permiso para editar productos.';
      return;
    }
    if (!this.editando && !this.authService.isAdmin()) {
      this.mensaje = 'No tienes permiso para crear productos.';
      return;
    }

    // Preparar el objeto producto para enviar al backend
    const productoToSend = { ...this.producto };
    if (productoToSend.marca && productoToSend.marca.id) {
      productoToSend.marca = { id: productoToSend.marca.id } as Marca; // Enviar solo el ID
    } else {
      productoToSend.marca = undefined; // Si no se seleccionó marca
    }
    if (productoToSend.categoria && productoToSend.categoria.id) {
      productoToSend.categoria = { id: productoToSend.categoria.id } as Categoria; // Enviar solo el ID
    } else {
      productoToSend.categoria = undefined; // Si no se seleccionó categoría
    }


    if (this.editando) {
      this.productoService.actualizarProducto(productoToSend).subscribe({
        next: () => {
          this.mensaje = 'Producto actualizado con éxito';
          this.productSaved.emit(true); // Emitir evento de guardado
          if (!this.productId) { // Si no se usa como modal, redirigir
            this.router.navigate(['/admin/productos']);
          }
        },
        error: (err) => this.mensaje = 'Error al actualizar producto: ' + (err.error || err.message)
      });
    } else {
      this.productoService.crearProducto(productoToSend).subscribe({
        next: () => {
          this.mensaje = 'Producto creado con éxito';
          this.productSaved.emit(true); // Emitir evento de guardado
          if (!this.productId) { // Si no se usa como modal, redirigir
            this.router.navigate(['/admin/productos']);
          }
        },
        error: (err) => this.mensaje = 'Error al crear producto: ' + (err.error || err.message)
      });
    }
  }
  // product-form.component.ts
eliminarProducto(): void {
    if (this.producto.id) {
        this.productoService.eliminarProducto(this.producto.id).subscribe({
            next: () => {
                this.mensaje = 'Producto eliminado con éxito.';
                this.router.navigate(['/admin/productos']); // Redirigir después de eliminar
            },
            error: () => this.mensaje = 'Error al eliminar producto'
        });
    } else {
        this.mensaje = 'No se puede eliminar un producto sin ID.';
    }
}


  cancelar(): void {
    this.cancelEdit.emit(); // Emitir evento de cancelación
    if (!this.productId) { // Si no se usa como modal, redirigir
      this.router.navigate(['/admin/productos']);
    }
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\products\products.component.css -----

    /* products.component.css */
    h2 {
      text-align: center;
      color: #333;
      margin-top: 20px;
      margin-bottom: 30px;
    }

    .filters-section {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap; /* Permite que los filtros se envuelvan en pantallas pequeñas */
    }

    .filters-section input,
    .filters-section select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      min-width: 180px; /* Ancho mínimo para los selectores */
    }

    .filters-section button {
      padding: 10px 20px;
      background-color: #1E88E5; /* Azul */
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }

    .filters-section button:hover {
      background-color: #0056b3;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* Columnas responsivas */
      gap: 25px; /* Espacio entre tarjetas */
      padding: 0 20px; /* Padding lateral */
      max-width: 1200px; /* Ancho máximo del grid */
      margin: 0 auto; /* Centrar el grid */
    }

    .product-card {
      background-color: #FFFFFF;
      border: 1px solid #ddd;
      border-radius: 10px; /* Bordes más redondeados */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Sombra más pronunciada */
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-5px); /* Efecto de elevación */
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .product-card h3 {
      color: #1E88E5;
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.3rem;
    }

    .product-card p {
      color: #555;
      margin-bottom: 5px;
    }

    .product-card button {
      background-color: #43A047; /* Verde para añadir al carrito */
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
      transition: background-color 0.3s ease;
    }

    .product-card button:hover {
      background-color: #388E3C;
    }

    .product-detail-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #FFFFFF;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      padding: 30px;
      z-index: 1000;
      max-width: 450px;
      text-align: center;
    }

    .product-detail-popup h3 {
      color: #1E88E5;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    .product-detail-popup p {
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .product-detail-popup button {
      background-color: #607D8B; /* Gris azulado para cerrar */
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 20px;
      transition: background-color 0.3s ease;
    }

    .product-detail-popup button:hover {
      background-color: #455A64;
    }
    


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\products\products.component.html -----

<h2>Catálogo de Productos</h2>

<!-- Barra de Búsqueda y Filtros -->
<div class="filters-section">
  <input type="text" [(ngModel)]="keyword" placeholder="Buscar por descripción..." (keyup.enter)="buscarProductos()">
  <button (click)="buscarProductos()">Buscar</button>

  <select [(ngModel)]="selectedCategory" (change)="filtrarProductos()">
    <option [ngValue]="null">Todas las Categorías</option>
    <option *ngFor="let categoria of categorias" [ngValue]="categoria.id">{{ categoria.nombre }}</option>
  </select>

  <select [(ngModel)]="selectedMarca" (change)="filtrarProductos()">
    <option [ngValue]="null">Todas las Marcas</option>
    <option *ngFor="let marca of marcas" [ngValue]="marca.id">{{ marca.nombre }}</option>
  </select>
</div>

<div class="product-grid">
  <div class="product-card" *ngFor="let producto of productos" (click)="seleccionarProducto(producto)">
    <h3>{{ producto.nombre }}</h3>
    <p>Precio: S/ {{ producto.precio }}</p>
    <p>Stock: {{ producto.stock }}</p>
    <p *ngIf="producto.marca">Marca: {{ producto.marca.nombre }}</p>
    <p *ngIf="producto.categoria">Categoría: {{ producto.categoria.nombre }}</p>
    <!-- Botón Añadir al Carrito -->
    <button *ngIf="auth.isComprador() || auth.isVisitante()" (click)="agregarAlCarrito(producto); $event.stopPropagation();">Añadir al Carrito</button>
    <p *ngIf="producto.stock === 0" style="color: red;">Sin stock disponible</p>
  </div>
</div>

<div *ngIf="productoSeleccionado" class="product-detail-popup">
  <h3>Detalle del Producto</h3>
  <p><strong>Nombre:</strong> {{ productoSeleccionado?.nombre }}</p>
  <p><strong>Descripción:</strong> {{ productoSeleccionado?.descripcion }}</p>
  <p><strong>Precio:</strong> S/ {{ productoSeleccionado?.precio }}</p>
  <p><strong>Stock:</strong> {{ productoSeleccionado?.stock }}</p>
  <p *ngIf="productoSeleccionado?.marca?.nombre"><strong>Marca:</strong> {{ productoSeleccionado?.marca?.nombre }}</p>
  <p *ngIf="productoSeleccionado?.categoria?.nombre"><strong>Categoría:</strong> {{ productoSeleccionado?.categoria?.nombre }}</p>
  <button *ngIf="auth.isComprador() || auth.isVisitante()" (click)="agregarAlCarrito(productoSeleccionado!)">Añadir al Carrito</button>
  <p *ngIf="productoSeleccionado?.stock === 0" style="color: red;">Sin stock disponible</p>
  <button (click)="productoSeleccionado = null">Cerrar</button>
</div>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\products\products.component.spec.ts -----

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { ProductsComponent } from './products.component';

describe('ProductsComponent', () => {
  let component: ProductsComponent;
  let fixture: ComponentFixture<ProductsComponent>;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [ProductsComponent]
    });
    fixture = TestBed.createComponent(ProductsComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\products\products.component.ts -----

import { CategoriaService } from 'src/app/model/categoria/categoria.service';// Importar CategoriaService
import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { HttpClient } from '@angular/common/http'; // Considera si aún necesitas HttpClient directamente aquí
import { environment } from '../../../environments/environment'; // Considera si aún necesitas environment directamente aquí
import { AuthService } from '../../auth/AuthService';
import { Router, RouterModule } from '@angular/router';
import { ProductoService } from '../../model/producto/producto.service';
import { Producto } from '../../model/producto/producto';
import { CarritoService } from 'src/app/model/carrito-item/carrito.service';
import { FormsModule } from '@angular/forms'; // Importar FormsModule
import { MarcaService } from 'src/app/model/Marca/marca.service'; // Importar MarcaService
import { Marca } from 'src/app/model/Marca/marca'; // Importar Marca
import { Categoria } from 'src/app/model/categoria/categoria';// Importar Categoria

@Component({
  selector: 'app-products',
  templateUrl: './products.component.html',
  styleUrls: ['./products.component.css'],
  standalone: true,
  imports: [
    CommonModule,
    RouterModule,
    FormsModule // Añadir FormsModule
  ]
})
export class ProductsComponent implements OnInit {
  productos: Producto[] = [];
  productoSeleccionado: Producto | null = null;
  keyword: string = '';
  marcas: Marca[] = [];
  categorias: Categoria[] = [];
  selectedMarca: number | null = null;
  selectedCategory: number | null = null;
  constructor(
    private http: HttpClient, // Puedes eliminar si no lo usas directamente
    public auth: AuthService,
    private router: Router, // Puedes eliminar si no lo usas directamente
    private productoService: ProductoService,
    private carritoService: CarritoService,
    private marcaService: MarcaService, // Inyectar MarcaService
    private categoriaService: CategoriaService // Inyectar CategoriaService
  ) {}
  ngOnInit() {
    this.loadProducts();
    this.loadMarcas();
    this.loadCategorias();
  }
  loadProducts() {
    this.productoService.getProductos().subscribe(data => {
      this.productos = data;
    });
  }
  loadMarcas() {
    this.marcaService.getMarcas().subscribe(data => {
      this.marcas = data;
    });
  }
  loadCategorias() {
    this.categoriaService.getCategorias().subscribe(data => {
      this.categorias = data;
    });
  }
  buscarProductos() {
    this.productoService.searchProductos(this.keyword).subscribe(productos => {
      this.productos = productos;
    });
  }
filtrarProductos() {
    // **IMPORTANTE:** Esta lógica filtra en el frontend. Para grandes datasets,
    // lo ideal es que el backend tenga un endpoint para filtrar por marca y/o categoría.
    // Si tu backend no tiene ese endpoint, esta función solo filtrará los productos
    // que ya se hayan cargado inicialmente.
    // Primero, recarga todos los productos para asegurar que el filtro se aplique sobre el conjunto completo
    // o ajusta para que la búsqueda y los filtros se combinen en una sola llamada al backend.
    this.productoService.getProductos().subscribe(allProducts => {
      let filtered = allProducts;
      if (this.selectedMarca) {
        filtered = filtered.filter(p => p.marca && p.marca.id === this.selectedMarca);
      }
      if (this.selectedCategory) {
        filtered = filtered.filter(p => p.categoria && p.categoria.id === this.selectedCategory);
      }
      // Si también hay una keyword, aplica la búsqueda sobre los resultados filtrados
      if (this.keyword) {
        filtered = filtered.filter(p => p.descripcion.toLowerCase().includes(this.keyword.toLowerCase()) || p.nombre.toLowerCase().includes(this.keyword.toLowerCase()));
      }
      this.productos = filtered;
    });
  }
  agregarAlCarrito(producto: Producto) {
    if (!producto || !producto.id || (producto.stock || 0) <= 0) {
      alert('No se puede añadir este producto al carrito.');
      return;
    }
    const cantidad = 1;
    this.carritoService.agregarProducto({ productoId: producto.id, cantidad: cantidad }).subscribe({
      next: () => {
        alert('Producto añadido al carrito!');
      },
      error: (err) => {
        console.error('Error al añadir al carrito:', err);
        alert('Error al añadir el producto al carrito. Por favor, intente de nuevo.');
      }
    });
  }
  seleccionarProducto(product: Producto) {
    this.productoSeleccionado = product;
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\register\register.component.css -----

/* register.component.css */
h2 {
  color: #333333;
  text-align: center;
  margin-top: 40px;
  margin-bottom: 30px;
}
form {
  background-color: #FFFFFF;
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  max-width: 400px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 20px;
}
form div {
  display: flex;
  flex-direction: column;
}

label {
  font-weight: bold;
  margin-bottom: 8px;
  color: #333333;
}
input {
  padding: 12px;
  font-size: 1.1rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}
button {
  padding: 12px 20px;
  background-color: #4CAF50; /* Verde para el botón de registrar */
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1.1rem;
  font-weight: bold;
  transition: background-color 0.3s ease;
}
button:hover {
  background-color: #45a049;
}
.error {
  color: #E53935;
  text-align: center;
  margin-top: 20px;
  margin-bottom: 10px;
  font-weight: bold;
}
.error-message {
  color: red;
  background-color: #ffe0e0;
  border: 1px solid red;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 5px;
  text-align: center;
}

.success-message {
  color: green;
  background-color: #e6ffe6;
  border: 1px solid green;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 5px;
  text-align: center;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\register\register.component.html -----

<h2>Registro de Usuario</h2>

<div *ngIf="error" class="error">{{ error }}</div>

<form (ngSubmit)="register()">
  <div>
    <label for="username">Usuario:</label>
    <input type="text" id="username" [(ngModel)]="username" name="username" required minlength="4" />
  </div>

  <div>
    <label for="password">Contraseña:</label>
    <input type="password" id="password" [(ngModel)]="password" name="password" required minlength="8"/>
  </div>

  <div>
    <label for="confirmPassword">Confirmar Contraseña:</label>
    <input type="password" id="confirmPassword" [(ngModel)]="confirmPassword" name="confirmPassword" required minlength="8" />
  </div>

  <button type="submit">Registrarse</button>
</form>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\register\register.component.spec.ts -----

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { RegisterComponent } from './register.component';

describe('RegisterComponent', () => {
  let component: RegisterComponent;
  let fixture: ComponentFixture<RegisterComponent>;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [RegisterComponent]
    });
    fixture = TestBed.createComponent(RegisterComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\register\register.component.ts -----

import { Component } from '@angular/core';
import { Router } from '@angular/router';
import { AuthService } from 'src/app/auth/AuthService';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { HttpErrorResponse } from '@angular/common/http';

@Component({
  selector: 'app-register',
  templateUrl: './register.component.html',
  styleUrls: ['./register.component.css'],
  standalone: true, // Si es un componente standalone
  imports: [
    CommonModule, // <-- Añadir aquí
    FormsModule   // <-- ¡Añadir aquí!
  ],
})
export class RegisterComponent {
  username = '';
  password = '';
  confirmPassword = '';
  error = '';
  successMessage = '';

  constructor(private authService: AuthService, private router: Router) {}

  register() {
        this.error = ''; // Limpiar errores al intentar registrar
        // Validaciones de longitud en el frontend
        if (this.username.length < 4) {
          this.error = 'El nombre de usuario debe tener al menos 4 caracteres.';
          return;
        }
        if (this.password.length < 8) {
          this.error = 'La contraseña debe tener al menos 8 caracteres.';
          return;
        }
        if (this.password !== this.confirmPassword) {
          this.error = 'Las contraseñas no coinciden';
          return;
        }

    this.authService.register({ username: this.username, password: this.password })
          .subscribe({
            next: (response: any) => { // <-- Asegúrate de capturar la respuesta
          this.error = ''; // Limpiar cualquier error previo
          // Puedes capturar el mensaje del backend si lo necesitas
          // this.successMessage = response; // Si el backend devuelve solo el string.
                                           // Si devuelve un objeto { message: "..." }, sería response.message
          this.successMessage = 'Usuario creado correctamente.'; // <-- ¡Mensaje de éxito deseado!
          console.log(this.successMessage); // Para depuración

          // Redirigir después de un breve retraso para que el usuario vea el mensaje
          setTimeout(() => {
            this.router.navigate(['/login']);
          }, 100); // Redirige después de 2 segundos (ajusta el tiempo si es necesario)
        },
            error: (err: HttpErrorResponse) => { // Capturar el error como HttpErrorResponse
              if (err.status === 409) { // 409 Conflict
                this.error = err.error; // El cuerpo de la respuesta contiene el mensaje "El nombre de usuario ya existe."
              } else {
                this.error = 'Error al registrar el usuario. Inténtelo de nuevo.';
              }
            }
          }); // subscribe

  }

}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\review-management\review-management.component.css -----

h2 {
  text-align: center;
  color: #333;
  margin-top: 20px;
  margin-bottom: 30px;
}

.mensaje {
  padding: 10px;
  margin: 10px auto;
  width: 80%;
  text-align: center;
  border-radius: 5px;
  font-weight: bold;
}

.mensaje[style*="color: red;"] {
  background-color: #ffe0e0;
  border: 1px solid #ffcccc;
  color: red;
}

.mensaje[style*="color: green;"] {
  background-color: #e0ffe0;
  border: 1px solid #ccffcc;
  color: green;
}

/* Formulario de creación/edición */
form, div.creation-form { /* Añadido div.creation-form para el formulario de creación de marca/categoría */
  display: flex;
  flex-direction: column;
  max-width: 500px;
  margin: 20px auto;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  gap: 15px;
  background-color: #fff;
}

form div, div.creation-form div {
  display: flex;
  flex-direction: column;
}

form label, div.creation-form label {
  font-weight: bold;
  margin-bottom: 5px;
  color: #333;
}

form input[type="text"],
form input[type="password"],
form input[type="number"],
form select,
div.creation-form input[type="text"] {
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
  width: 100%;
  box-sizing: border-box;
}

button {
  padding: 10px 15px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  transition: background-color 0.3s ease;
  color: white;
  background-color: #007bff; /* Color primario */
}

button:hover {
  background-color: #0056b3;
}

button[style*="background-color: #dc3545;"] { /* Estilo para botones de eliminar */
  background-color: #dc3545;
}
button[style*="background-color: #dc3545;"]:hover {
  background-color: #c82333;
}

button[style*="background-color: #28a745;"] { /* Estilo para botones de éxito/aprobar */
  background-color: #28a745;
}
button[style*="background-color: #28a745;"]:hover {
  background-color: #218838;
}

button[style*="background-color: orange;"] { /* Estilo para botones de advertencia */
  background-color: orange;
}
button[style*="background-color: orange;"]:hover {
  background-color: darkorange;
}

button[style*="background-color: gray;"] { /* Estilo para botones de cancelar */
  background-color: gray;
}
button[style*="background-color: gray;"]:hover {
  background-color: darkgray;
}

table {
  width: 90%;
  margin: 20px auto;
  border-collapse: collapse;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  background-color: #fff;
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 12px 15px;
  border: 1px solid #ddd;
  text-align: left;
}

th {
  background-color: #f2f2f2;
  font-weight: bold;
  color: #333;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}

tr:hover {
  background-color: #f1f1f1;
}

h3 {
  text-align: center;
  color: #333;
  margin-top: 20px;
  margin-bottom: 15px;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\review-management\review-management.component.html -----

<h2>Moderación de Reseñas</h2>

<div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

<table *ngIf="resenasPendientes.length > 0">
  <thead>
    <tr>
      <th>ID Reseña</th>
      <th>ID Producto</th>
      <th>Comentario</th>
      <th>Puntuación</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let resena of resenasPendientes">
      <td>{{ resena.id }}</td>
      <td>{{ resena.productoId }}</td>
      <td>{{ resena.comentario }}</td>
      <td>{{ resena.puntuacion }}</td>
      <td>
        <button (click)="aprobarResena(resena.id!)" style="background-color: #28a745;">Aprobar</button>
        <button (click)="rechazarResena(resena.id!)" style="background-color: #dc3545;">Rechazar</button>
      </td>
    </tr>
  </tbody>
</table>

<p *ngIf="resenasPendientes.length === 0">No hay reseñas pendientes de moderación.</p>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\review-management\review-management.component.ts -----

import { Component, OnInit } from '@angular/core';
import { Resena } from 'src/app/model/reseña/reseña';
import { ResenaService } from 'src/app/model/reseña/reseña.service';
@Component({
  selector: 'app-review-management',
  templateUrl: './review-management.component.html',
  styleUrls: ['./review-management.component.css']
})
export class ReviewManagementComponent implements OnInit {
  resenasPendientes: Resena[] = [];
  mensaje: string = '';

  constructor(
    private resenaService: ResenaService // Inyectar ResenaService
  ) {}

  ngOnInit(): void {
    this.loadResenasPendientes();
  }

  loadResenasPendientes(): void {
    // Asumiendo que hay un endpoint en ResenaService para obtener reseñas pendientes de aprobación
    // Si no existe, necesitarías añadirlo en el backend (ej. GET /reseñas/pendientes)
    // Por ahora, simulamos datos.
    // this.resenaService.getResenasPendientes().subscribe({
    //   next: (data) => this.reseñasPendientes = data,
    //   error: (err) => this.mensaje = 'Error al cargar reseñas: ' + (err.error || err.message)
    // });
    this.resenasPendientes = [
      { id: 1, productoId: 101, comentario: 'Buen producto, pero llegó tarde.', puntuacion: 4, aprobado: false },
      { id: 2, productoId: 102, comentario: 'Excelente calidad, muy recomendado.', puntuacion: 5, aprobado: false }
    ];
  }

  aprobarResena(id: number): void {
    this.resenaService.aprobar(id).subscribe({
      next: () => {
        this.mensaje = 'Reseña aprobada con éxito.';
        this.loadResenasPendientes(); // Recargar la lista
      },
      error: (err) => this.mensaje = 'Error al aprobar reseña: ' + (err.error || err.message)
    });
  }

  rechazarResena(id: number): void {
    if (confirm('¿Estás seguro de que quieres rechazar esta reseña?')) {
      // Asumiendo que hay un endpoint en ResenaService para rechazar/eliminar reseñas
      // Si no existe, necesitarías añadirlo en el backend (ej. DELETE /reseñas/{id})
      // Por ahora, simulamos la eliminación.
      // this.resenaService.eliminarResena(id).subscribe({
      //   next: () => {
      //     this.mensaje = 'Reseña rechazada/eliminada con éxito.';
      //     this.loadResenasPendientes();
      //   },
      //   error: (err) => this.mensaje = 'Error al rechazar reseña: ' + (err.error || err.message)
      // });
      this.mensaje = `Reseña con ID ${id} rechazada (simulado).`;
      this.resenasPendientes = this.resenasPendientes.filter(r => r.id !== id);
    }
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\user-management\create-user-modal\create-user-modal.component.css -----

/* Estilos para el overlay del modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6); /* Fondo semi-transparente oscuro */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000; /* Asegura que esté por encima de otros elementos */
}

/* Estilos para el contenido del modal */
.modal-content {
  background-color: #fff;
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  width: 90%;
  max-width: 500px; /* Ancho máximo para el modal */
  position: relative;
  box-sizing: border-box; /* Incluye padding y border en el width/height */
}

.modal-content h3 {
  margin-top: 0;
  color: #333;
  text-align: center;
  margin-bottom: 20px;
}

.modal-content label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
  color: #555;
}

.modal-content input[type="text"],
.modal-content input[type="password"],
.modal-content select {
  width: calc(100% - 20px); /* Ajusta el ancho para el padding */
  padding: 10px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box; /* Incluye padding y border en el width/height */
}

.modal-actions {
  text-align: right;
  margin-top: 20px;
}

.modal-actions button {
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
  margin-left: 10px;
  transition: background-color 0.3s ease;
}

.modal-actions button:first-child { /* Botón principal (Crear) */
  background-color: #28a745; /* Verde */
  color: white;
}

.modal-actions button:first-child:hover {
  background-color: #218838;
}

.modal-actions .cancel-button {
  background-color: #6c757d; /* Gris */
  color: white;
}

.modal-actions .cancel-button:hover {
  background-color: #5a6268;
}

/* Mensajes de error dentro del modal */
.error-message {
  color: red;
  background-color: #ffe0e0;
  border: 1px solid red;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 5px;
  text-align: center;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\user-management\create-user-modal\create-user-modal.component.html -----

<div class="modal-overlay" *ngIf="visible">
  <div class="modal-content">
    <h3>Crear Nuevo Usuario</h3>

    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <div>
      <label for="newUsername">Usuario:</label>
      <input type="text" id="newUsername" [(ngModel)]="nuevoUsuario.username" name="newUsername" required />
    </div>
    <div>
      <label for="newPassword">Contraseña:</label>
      <input type="password" id="newPassword" [(ngModel)]="nuevoUsuario.password" name="newPassword" required />
    </div>
    <div>
      <label for="confirmNewPassword">Confirmar Contraseña:</label>
      <input type="password" id="confirmNewPassword" [(ngModel)]="confirmPassword" name="confirmNewPassword" required />
    </div>
    <div>
      <label for="newNombre">Nombre:</label>
      <input type="text" id="newNombre" [(ngModel)]="nuevoUsuario.nombre" name="newNombre" required />
    </div>
    <div>
      <label for="newRole">Rol:</label>
      <select id="newRole" [(ngModel)]="nuevoUsuario.role" name="newRole" required>
          <option value="ADMIN">ADMIN</option>
          <option value="USER">USER</option>
          <option value="COMPRADOR">COMPRADOR</option>
          <option value="VISITANTE">VISITANTE</option>
      </select>
    </div>
    <div class="modal-actions">
      <button (click)="crearUsuario()">Crear Usuario</button>
      <button (click)="cerrarModal()" class="cancel-button">Cancelar</button>
    </div>
  </div>
</div>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\user-management\create-user-modal\create-user-modal.component.ts -----

import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { Usuario } from 'src/app/model/usuario/usuario'; // Asegúrate de importar tu interfaz Usuario
import { UsuarioService } from 'src/app/model/usuario/usuario.service'; // Asegúrate de importar tu servicio
import { HttpErrorResponse } from '@angular/common/http'; // Para manejar errores

@Component({
  selector: 'app-create-user-modal',
  templateUrl: './create-user-modal.component.html',
  styleUrls: ['./create-user-modal.component.css'],
  standalone: true,
  imports: [
    CommonModule,
    FormsModule
  ]
})
export class CreateUserModalComponent implements OnInit {
  @Input() visible: boolean = false; // Controla la visibilidad del modal
  @Output() close = new EventEmitter<void>(); // Emite cuando se quiere cerrar el modal
  @Output() userCreated = new EventEmitter<string>(); // Emite un mensaje al crear usuario

  nuevoUsuario: Usuario = {
    username: '',
    password: '',
    nombre: '',
    role: 'COMPRADOR' // Rol predeterminado
  };
  confirmPassword = '';
  errorMessage = ''; // Mensaje de error interno del modal

  constructor(private usuarioService: UsuarioService) { }

  ngOnInit(): void {
    // Al inicializar o cuando el modal se hace visible, puedes resetear el formulario
    this.resetForm();
  }

  // Método para cerrar el modal
  cerrarModal(): void {
    this.resetForm(); // Limpiar formulario al cerrar
    this.close.emit(); // Emitir evento para que el padre lo oculte
  }

  crearUsuario(): void {
    this.errorMessage = ''; // Limpiar errores previos

    if (!this.nuevoUsuario.username || !this.nuevoUsuario.password || !this.nuevoUsuario.nombre || !this.nuevoUsuario.role) {
      this.errorMessage = 'Todos los campos son obligatorios.';
      return;
    }

    if (this.nuevoUsuario.password !== this.confirmPassword) {
      this.errorMessage = 'Las contraseñas no coinciden.';
      return;
    }

    this.usuarioService.crearUsuario(this.nuevoUsuario).subscribe({
      next: (res) => {
        this.userCreated.emit('Usuario creado con éxito.'); // Emitir mensaje de éxito al padre
        this.cerrarModal(); // Cerrar el modal después de crear
      },
      error: (err: HttpErrorResponse) => {
        if (err.status === 409) { // Conflicto: Usuario ya existe
          this.errorMessage = 'El nombre de usuario ya existe.';
        } else {
          this.errorMessage = 'Error al crear usuario: ' + (err.error?.message || err.message || 'Error desconocido');
        }
        console.error('Error al crear usuario:', err);
      }
    });
  }

  resetForm(): void {
    this.nuevoUsuario = { username: '', password: '', nombre: '', role: 'COMPRADOR' };
    this.confirmPassword = '';
    this.errorMessage = '';
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\user-management\edit-user-modal\edit-user-modal.component.css -----

/* Copia y pega aquí el contenido de create-user-modal.component.css */
/* Estilos para el overlay del modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

/* Estilos para el contenido del modal */
.modal-content {
  background-color: #fff;
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  width: 90%;
  max-width: 500px;
  position: relative;
  box-sizing: border-box;
}

.modal-content h3 {
  margin-top: 0;
  color: #333;
  text-align: center;
  margin-bottom: 20px;
}

.modal-content label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
  color: #555;
}

.modal-content input[type="text"],
.modal-content input[type="password"],
.modal-content select {
  width: calc(100% - 20px);
  padding: 10px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

.modal-actions {
  text-align: right;
  margin-top: 20px;
}

.modal-actions button {
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
  margin-left: 10px;
  transition: background-color 0.3s ease;
}

.modal-actions button:first-child {
  background-color: #28a745;
  color: white;
}

.modal-actions button:first-child:hover {
  background-color: #218838;
}

.modal-actions .cancel-button {
  background-color: #6c757d;
  color: white;
}

.modal-actions .cancel-button:hover {
  background-color: #5a6268;
}

/* Mensajes de error dentro del modal */
.error-message {
  color: red;
  background-color: #ffe0e0;
  border: 1px solid red;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 5px;
  text-align: center;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\user-management\edit-user-modal\edit-user-modal.component.html -----

<div class="modal-overlay" *ngIf="visible">
  <div class="modal-content">
    <h3>Editar Usuario</h3>

    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <div>
      <label for="editUsername">Usuario:</label>
      <input type="text" id="editUsername" [(ngModel)]="usuarioEditado.username" name="editUsername" required [disabled]="true" />
      </div>
    <div>
      <label for="editNombre">Nombre:</label>
      <input type="text" id="editNombre" [(ngModel)]="usuarioEditado.nombre" name="editNombre" required />
    </div>
    <div>
      <label for="editRole">Rol:</label>
      <select id="editRole" [(ngModel)]="usuarioEditado.role" name="editRole" required>
          <option value="ADMIN">ADMIN</option>
          <option value="USER">USER</option>
          <option value="COMPRADOR">COMPRADOR</option>
          <option value="VISITANTE">VISITANTE</option>
      </select>
    </div>
    <div>
      <label for="editPassword">Contraseña:</label>
      <input type="password" id="editPassword" [(ngModel)]="usuarioEditado.password" name="editPassword" placeholder="Dejar en blanco para no cambiar" />
    </div>
    <div class="modal-actions">
      <button (click)="guardarCambios()">Guardar Cambios</button>
      <button (click)="cerrarModal()" class="cancel-button">Cancelar</button>
    </div>
  </div>
</div>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\user-management\edit-user-modal\edit-user-modal.component.ts -----

import { Component, Input, Output, EventEmitter, OnInit, OnChanges, SimpleChanges } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { Usuario } from 'src/app/model/usuario/usuario'; // Asegúrate de importar tu interfaz Usuario
import { UsuarioService } from 'src/app/model/usuario/usuario.service';
import { HttpErrorResponse } from '@angular/common/http';

@Component({
  selector: 'app-edit-user-modal',
  templateUrl: './edit-user-modal.component.html',
  styleUrls: ['./edit-user-modal.component.css'],
  standalone: true,
  imports: [
    CommonModule,
    FormsModule
  ]
})
export class EditUserModalComponent implements OnChanges {
  @Input() visible: boolean = false;
  @Input() usuarioOriginal: Usuario | null = null; // Recibe el usuario a editar
  @Output() close = new EventEmitter<void>(); // Emite cuando se quiere cerrar
  @Output() userEdited = new EventEmitter<string>(); // Emite un mensaje al editar

  usuarioEditado: Usuario = { // Este será el modelo del formulario
    username: '',
    password: '', // La contraseña podría no ser obligatoria para la edición
    nombre: '',
    role: 'COMPRADOR'
  };
  errorMessage = ''; // Mensaje de error interno del modal

  constructor(private usuarioService: UsuarioService) { }

  ngOnChanges(changes: SimpleChanges): void {
    if (changes['usuarioOriginal'] && this.usuarioOriginal) {
      // Cuando el usuarioOriginal cambia (es decir, se abre el modal con un nuevo usuario),
      // copiamos sus propiedades al usuarioEditado para el formulario.
      this.usuarioEditado = { ...this.usuarioOriginal };
      // Opcional: limpiar la contraseña si no la quieres mostrar o si siempre es un nuevo campo.
      this.usuarioEditado.password = '';
      this.errorMessage = ''; // Limpiar errores al cargar nuevo usuario
    }
  }

  cerrarModal(): void {
    this.close.emit();
    this.errorMessage = ''; // Limpiar errores al cerrar
  }

  guardarCambios(): void {
    this.errorMessage = '';

    if (!this.usuarioEditado.username || !this.usuarioEditado.nombre || !this.usuarioEditado.role) {
      this.errorMessage = 'Los campos de usuario, nombre y rol son obligatorios.';
      return;
    }

    this.usuarioService.editarUsuario(this.usuarioEditado).subscribe({
      next: (res) => {
        this.userEdited.emit('Usuario actualizado con éxito.');
        this.cerrarModal(); // Cerrar el modal después de guardar
      },
      error: (err: HttpErrorResponse) => {
        this.errorMessage = 'Error al actualizar usuario: ' + (err.error?.message || err.message || 'Error desconocido');
        console.error('Error al actualizar usuario:', err);
      }
    });
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\user-management\user-management.component.css -----

/* Estilos generales para el componente de gestión de usuarios */
h2 {
    text-align: center;
    color: #333;
    margin-top: 20px;
}

.mensaje {
    color: red;
    text-align: center;
    margin-bottom: 1rem;
}

button {
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
    transition: background-color 0.3s ease;
    color: white;
    background-color: #007bff; /* Color primario */
}

button:hover {
    background-color: #0056b3;
}

input[type="text"],
input[type="password"],
select {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 1rem;
    width: 100%;
    box-sizing: border-box; /* Para incluir padding y border en el ancho */
    margin-bottom: 10px; /* Espaciado entre campos */
}

form {
    display: flex;
    flex-direction: column;
    max-width: 500px;
    margin: 20px auto;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    gap: 15px;
}

form div {
    display: flex;
    flex-direction: column;
}

form label {
    font-weight: bold;
    margin-bottom: 5px;
    color: #333;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

th, td {
    padding: 12px 15px;
    border: 1px solid #ddd;
    text-align: left;
}

th {
    background-color: #f2f2f2;
    font-weight: bold;
    color: #333;
}

tr:nth-child(even) {
    background-color: #f9f9f9;
}

tr:hover {
    background-color: #f1f1f1;
}
    /* products.component.css */
    h2 {
      text-align: center;
      color: #333;
      margin-top: 20px;
      margin-bottom: 30px;
    }

    .filters-section {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap; /* Permite que los filtros se envuelvan en pantallas pequeñas */
    }

    .filters-section input,
    .filters-section select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      min-width: 180px; /* Ancho mínimo para los selectores */
    }

    .filters-section button {
      padding: 10px 20px;
      background-color: #1E88E5; /* Azul */
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }

    .filters-section button:hover {
      background-color: #0056b3;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* Columnas responsivas */
      gap: 25px; /* Espacio entre tarjetas */
      padding: 0 20px; /* Padding lateral */
      max-width: 1200px; /* Ancho máximo del grid */
      margin: 0 auto; /* Centrar el grid */
    }

    .product-card {
      background-color: #FFFFFF;
      border: 1px solid #ddd;
      border-radius: 10px; /* Bordes más redondeados */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Sombra más pronunciada */
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-5px); /* Efecto de elevación */
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .product-card h3 {
      color: #1E88E5;
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.3rem;
    }

    .product-card p {
      color: #555;
      margin-bottom: 5px;
    }

    .product-card button {
      background-color: #43A047; /* Verde para añadir al carrito */
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
      transition: background-color 0.3s ease;
    }

    .product-card button:hover {
      background-color: #388E3C;
    }

    .product-detail-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #FFFFFF;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      padding: 30px;
      z-index: 1000;
      max-width: 450px;
      text-align: center;
    }

    .product-detail-popup h3 {
      color: #1E88E5;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    .product-detail-popup p {
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .product-detail-popup button {
      background-color: #607D8B; /* Gris azulado para cerrar */
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 20px;
      transition: background-color 0.3s ease;
    }

    .product-detail-popup button:hover {
      background-color: #455A64;
    }
    



----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\user-management\user-management.component.html -----

<h2>Gestión de Usuarios</h2>

<div *ngIf="mensaje" class="mensaje" [ngClass]="{'exito': mensajeTipo === 'exito', 'error': mensajeTipo === 'error'}">
  {{ mensaje }}
</div>

<button (click)="mostrarFormularioNuevoUsuario()">Nuevo Usuario</button>

<app-create-user-modal
  [visible]="showCreateUserModal"
  (close)="onCloseCreateUserModal()"
  (userCreated)="onUserCreated($event)">
</app-create-user-modal>

<app-edit-user-modal
  [visible]="showEditUserModal"
  [usuarioOriginal]="selectedUser" (close)="onCloseEditUserModal()"
  (userEdited)="onUserEdited($event)">
</app-edit-user-modal>


<table *ngIf="usuarios.length > 0">
    <thead>
        <tr>
            <th>ID</th>
            <th>Usuario</th>
            <th>Nombre</th>
            <th>Rol</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let user of usuarios">
            <td>{{ user.id }}</td>
            <td>{{ user.username }}</td>
            <td>{{ user.nombre || 'N/A' }}</td>
            <td>{{ user.role }}</td>
            <td>
                <button (click)="editarUsuario(user.id!)">Editar</button>
                <button (click)="eliminarUsuario(user.id!)" style="background-color: #dc3545;">Eliminar</button>
            </td>
        </tr>
    </tbody>
</table>

<p *ngIf="usuarios.length === 0">No hay usuarios registrados.</p>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\componentes\user-management\user-management.component.ts -----

import { Component, OnInit } from '@angular/core';
import { Usuario } from 'src/app/model/usuario/usuario';
import { UsuarioService } from 'src/app/model/usuario/usuario.service';
import { AuthService } from 'src/app/auth/AuthService';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { CreateUserModalComponent } from './create-user-modal/create-user-modal.component'; // Importar modal de creación
import { EditUserModalComponent } from './edit-user-modal/edit-user-modal.component';     // ¡Importar el nuevo modal de edición!

@Component({
  selector: 'app-user-management',
  templateUrl: './user-management.component.html',
  styleUrls: ['./user-management.component.css'],
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    CreateUserModalComponent, // Añadir a imports
    EditUserModalComponent    // ¡Añadir a imports!
  ]
})
export class UserManagementComponent implements OnInit {
  usuarios: Usuario[] = [];
  mensaje: string = '';
  mensajeTipo: 'exito' | 'error' | '' = '';

  // Propiedades para controlar los modales
  showCreateUserModal: boolean = false; // Controla el modal de creación
  showEditUserModal: boolean = false;   // ¡NUEVO! Controla el modal de edición
  selectedUser: Usuario | null = null;  // ¡NUEVO! Almacena el usuario a editar

  constructor(
    private usuarioService: UsuarioService,
    public authService: AuthService
  ) {}

  ngOnInit(): void {
    this.loadUsers();
  }

  loadUsers(): void {
    this.usuarioService.listarUsuarios().subscribe({
      next: (data) => {
        this.usuarios = data;
        // Opcional: limpiar el mensaje si la carga es exitosa después de una operación
        // this.mensaje = '';
        // this.mensajeTipo = '';
      },
      error: (err) => {
        this.mensaje = 'Error al cargar usuarios: ' + (err.error?.message || err.message);
        this.mensajeTipo = 'error';
      }
    });
  }

  // Lógica para el modal de CREACIÓN
  mostrarFormularioNuevoUsuario(): void {
    this.mensaje = ''; // Limpiar mensaje de la tabla principal
    this.mensajeTipo = '';
    this.showCreateUserModal = true;
  }

  onCloseCreateUserModal(): void {
    this.showCreateUserModal = false;
  }

  onUserCreated(message: string): void {
    this.mensaje = message;
    this.mensajeTipo = 'exito';
    this.loadUsers(); // Recargar la lista para ver el nuevo usuario
    setTimeout(() => { this.mensaje = ''; this.mensajeTipo = ''; }, 3000);
  }

  // Lógica para el modal de EDICIÓN
  editarUsuario(id: number): void {
    const userToEdit = this.usuarios.find(user => user.id === id);
    if (userToEdit) {
      this.selectedUser = { ...userToEdit }; // Copia profunda para no modificar el original directamente
      this.mensaje = ''; // Limpiar mensaje de la tabla principal
      this.mensajeTipo = '';
      this.showEditUserModal = true; // Mostrar el modal de edición
    }
  }

  onCloseEditUserModal(): void {
    this.showEditUserModal = false;
    this.selectedUser = null; // Limpiar el usuario seleccionado
  }

  onUserEdited(message: string): void {
    this.mensaje = message;
    this.mensajeTipo = 'exito';
    this.loadUsers(); // Recargar la lista para ver los cambios
    setTimeout(() => { this.mensaje = ''; this.mensajeTipo = ''; }, 3000);
  }

  // El método 'guardarEdicion()' y 'resetForm()' que manejaban la edición directa ya no son necesarios
  // porque la lógica se mueve al 'EditUserModalComponent'. Puedes eliminarlos si no tienen otro uso.
  /*
  guardarEdicion(): void {
      // Lógica de edición se mueve a EditUserModalComponent
  }
  resetForm(): void {
      // Lógica de reseteo se mueve a EditUserModalComponent
  }
  */

  eliminarUsuario(id: number): void {
    if (confirm('¿Estás seguro de que quieres eliminar este usuario?')) {
      this.usuarioService.eliminarUsuario(id).subscribe({
        next: () => {
          this.mensaje = 'Usuario eliminado con éxito.';
          this.mensajeTipo = 'exito';
          this.loadUsers();
          setTimeout(() => { this.mensaje = ''; this.mensajeTipo = ''; }, 3000);
        },
        error: (err) => {
          this.mensaje = 'Error al eliminar usuario: ' + (err.error?.message || err.message);
          this.mensajeTipo = 'error';
          console.error('Error al eliminar usuario:', err);
          setTimeout(() => { this.mensaje = ''; this.mensajeTipo = ''; }, 5000);
        }
      });
    }
  }

  asignarRol(username: string, role: string): void {
    this.usuarioService.asignarRol(username, role).subscribe({
      next: () => {
        this.mensaje = `Rol de ${username} actualizado a ${role}.`;
        this.mensajeTipo = 'exito';
        this.loadUsers();
        setTimeout(() => { this.mensaje = ''; this.mensajeTipo = ''; }, 3000);
      },
      error: (err) => {
        this.mensaje = 'Error al asignar rol: ' + (err.error?.message || err.message);
        this.mensajeTipo = 'error';
      }
    });
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\guards\admin-guard.guard.spec.ts -----



----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\guards\admin-guard.guard.ts -----

import { Injectable } from '@angular/core';
import { CanActivate, Router } from '@angular/router';
import { AuthService } from '../auth/AuthService';

@Injectable({
  providedIn: 'root'
})
export class AdminGuard implements CanActivate {
  constructor(private authService: AuthService, private router: Router) {}

  canActivate(): boolean {
    if (this.authService.isAuthenticated() && this.authService.isAdmin()) {
      return true;
    }
    this.router.navigate(['/login']);
    return false;
  }

}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\guards\auth-guard.guard.spec.ts -----



----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\guards\auth-guard.guard.ts -----

import { Injectable } from '@angular/core';
import { CanActivate, Router } from '@angular/router';
import { AuthService } from '../auth/AuthService';

@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanActivate {
  constructor(private authService: AuthService, private router: Router) {}

  canActivate(): boolean {
    if (this.authService.isAuthenticated()) {
      return true;
    }
    this.router.navigate(['/login']);
    return false;
  }
}



----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\guards\user.admin-guard.ts -----

import { Injectable } from '@angular/core';
import { CanActivate, Router } from '@angular/router';
import { AuthService } from '../auth/AuthService';

@Injectable({ providedIn: 'root' })
export class UserAdminGuard implements CanActivate {
  constructor(private authService: AuthService, private router: Router) {}

  canActivate(): boolean {
    if (this.authService.isAuthenticated() && (this.authService.isUser() || this.authService.isAdmin())) {
      return true;
    }
    this.router.navigate(['/login']);
    return false;
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\layout\navbar\navbar.component.css -----

/* Estilos Navbar */
.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #2E3A59;
  color: white;
  padding: 12px 24px;
  position: sticky;
  top: 0;
  z-index: 1000;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.navbar a {
  color: #FFFFFF;
  text-decoration: none;
  margin: 0 12px;
  font-weight: 500;
  transition: color 0.3s ease;
}

.navbar a:hover {
  color: #FFD54F; /* amarillo claro */
}

.logout-button {
  background-color: #EF5350;
  border: none;
  color: white;
  padding: 6px 12px;
  border-radius: 4px;
  margin-left: 12px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.logout-button:hover {
  background-color: #D32F2F;
}

/* Footer */
.footer {
  background-color: #222;
  color: white;
  text-align: center;
  padding: 1rem;
}
/* Asegura que el cuerpo ocupe toda la pantalla y acomode el footer al fondo */
html, body {
  height: 100%;
  margin: 0;
  display: flex;
  flex-direction: column;
}

app-root {
  display: flex;
  flex-direction: column;
  flex: 1;
}

/* El contenido principal debe crecer para empujar el footer abajo */
.main-content {
  flex: 1;
}




----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\layout\navbar\navbar.component.html -----

<nav class="navbar">
  <div class="navbar-left">
    <a routerLink="/products">Productos</a>
  </div>

  <div class="navbar-center">
    <a routerLink="/carrito">Carrito</a>
  </div>

  <div class="navbar-right">
    <ng-container *ngIf="!authService.isAuthenticated()">
      <a routerLink="/login">Iniciar sesión</a>
      <a routerLink="/register">Registrarse</a>
    </ng-container>

    <ng-container *ngIf="authService.isAuthenticated()">
      <a routerLink="/perfil">Perfil</a>
      <a routerLink="/pedidos">Pedidos</a>

      <ng-container *ngIf="authService.isUser() || authService.isAdmin()">
        <a routerLink="/admin/productos">Gestión Productos</a>
        <a routerLink="/admin/pedidos">Gestión Pedidos</a>
        <a routerLink="/admin/categorias">Gestión Categorías</a>
        <a routerLink="/admin/marcas">Gestión Marcas</a>
        <a routerLink="/admin/resenas">Moderación Reseñas</a>
        <a routerLink="/admin/usuarios">Gestión Usuarios</a>
      </ng-container>
<!-- 
      <ng-container *ngIf="authService.isAdmin()">
        <a routerLink="/admin">Panel Admin</a>
      </ng-container> -->

      <button class="logout-button" (click)="logout()">Salir</button>
    </ng-container>
  </div>
</nav>

<footer class="footer">
  <p>© {{ currentYear }} Ventas Online</p>
</footer>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\layout\navbar\navbar.componet.ts -----

import { Component } from '@angular/core';
import { AuthService } from 'src/app/auth/AuthService';
import { CommonModule } from '@angular/common';
import { RouterModule } from '@angular/router';

@Component({
  selector: 'app-navbar',
  templateUrl: './navbar.component.html',
  styleUrls: ['./navbar.component.css'],
      standalone: true, // <--- ¡Añadir esto!
      imports: [
        CommonModule,
        RouterModule // <--- ¡Añadir esto!
      ]
})
export class NavbarComponent {
  constructor(public authService: AuthService) {}

  currentYear = new Date().getFullYear();
  logout() {
    this.authService.logout();
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\boleta\boleta.service.spec.ts -----

import { TestBed } from '@angular/core/testing';

import { BoletaService } from './boleta.service';

describe('BoletaService', () => {
  let service: BoletaService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(BoletaService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\boleta\boleta.service.ts -----

import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Boleta } from './boleta';
import { PedidoRequest } from '../pedido-request/pedido-request';
import { environment } from '../../../environments/environment';
import { Observable } from 'rxjs';
import { HttpHeaders } from '@angular/common/http';
import { AuthService } from '../../auth/AuthService';


@Injectable({ providedIn: 'root' })
export class BoletaService {

  private apiUrl = `${environment.apiUrl}/boletas`;


  private baseUrl = `${environment.apiUrl}/boletas`;

  constructor(private http: HttpClient, private authService: AuthService) {}
   // Asegúrate de que AuthService esté correctamente inyectado

  generarBoleta(pedidos: PedidoRequest[]) {
    return this.http.post(`${this.baseUrl}/generar`, pedidos);
  }
  getAllBoletasForAdmin(): Observable<any[]> {
    const token = this.authService.getToken(); // Obtener el token del AuthService [cite: 11]
    const headers = new HttpHeaders().set('Authorization', `Bearer ${token}`);
    return this.http.get<any[]>(`${this.apiUrl}/admin/todas`, { headers });
  }
  deleteBoleta(id: number): Observable<string> {
    const token = this.authService.getToken();
    const headers = new HttpHeaders().set('Authorization', `Bearer ${token}`);
    return this.http.delete(`${this.apiUrl}/${id}`, { headers, responseType: 'text' });
  }

  // Si implementas historial:
  obtenerHistorial() {
    return this.http.get<Boleta[]>(`${this.baseUrl}/historial`);
  }
  descargarBoletaPdf(boletaId: number): Observable<Blob> {
    // Es crucial que el responseType sea 'blob' para manejar correctamente el archivo binario.
    // Si tu backend requiere algún encabezado (ej. token de autenticación), añádelo aquí.
    const headers = new HttpHeaders({
      // 'Authorization': 'Bearer ' + tuTokenDeAutenticacion, // Ejemplo si usas token
      'Accept': 'application/pdf' // Indica que esperas un PDF
    });

    return this.http.get(`${this.apiUrl}/${boletaId}/pdf`, {
      responseType: 'blob', // MUY IMPORTANTE: para recibir el archivo binario
      headers: headers
    });
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\boleta\boleta.ts -----

    // app-ventas\src\app\model\boleta\boleta.ts
    import { Usuario } from "../usuario/usuario";
import { DetalleBoleta } from "./detalle-boleta";

    export interface Boleta {
      id?: number;
      usuario?: Usuario; // Si necesitas el usuario asociado a la boleta
      numeroBoleta?: string; // Añadido
      fechaEmision?: string; // Cambiado de 'fecha' a 'fechaEmision'
      subtotal?: number; // Añadido
      igv?: number; // Añadido
      total?: number;
      detalles: DetalleBoleta[];
      // usuario?: any; // Si necesitas el usuario asociado a la boleta
    }



----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\boleta\detalle-boleta.ts -----


import { Producto } from 'src/app/model/producto/producto';

export interface DetalleBoleta {
  id?: number;
  producto?: Producto;
  cantidad?: number;
  precioUnitario?: number;
  subtotalDetalle?: number; // Cambiado de 'subtotal' a 'subtotalDetalle'
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\carrito-item\carrito-item.ts -----

import { Producto } from "../producto/producto";

export interface CarritoItem {
  id?: number;
  producto: Producto;
  cantidad: number;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\carrito-item\carrito.service.spec.ts -----

import { TestBed } from '@angular/core/testing';

import { CarritoService } from './carrito.service';

describe('CarritoService', () => {
  let service: CarritoService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(CarritoService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\carrito-item\carrito.service.ts -----

import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { CarritoItem } from './carrito-item';
import { PedidoRequest } from '../pedido-request/pedido-request';
import { environment } from '../../../environments/environment';

@Injectable({ providedIn: 'root'  })
export class CarritoService {
  private baseUrl = `${environment.apiUrl}/carrito`;
  private pedidoUrl = `${environment.apiUrl}/pedidos`;

  constructor(private http: HttpClient)
        {}

  obtenerCarrito() {
    return this.http.get<CarritoItem[]>(this.baseUrl);
  }

  limpiarCarrito() {
    return this.http.delete(`${this.baseUrl}/limpiar`);
  }

  agregarProducto(pedido: PedidoRequest) {
    return this.http.post(`${this.baseUrl}/agregar`, pedido);
  }

  crearPedido(pedidos: PedidoRequest[]) {
    return this.http.post(`${this.pedidoUrl}/crear`, pedidos);
  }

  eliminarProducto(itemId: number) {
    return this.http.delete(`${this.baseUrl}/${itemId}`);
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\categoria\categoria.service.ts -----

import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { Categoria } from './categoria'; // Asegúrate de que la ruta sea correcta
import { environment } from '../../../environments/environment'; // Asegúrate de la ruta correcta
@Injectable({
  providedIn: 'root' // Esto hace que el servicio esté disponible en toda la aplicación
})
export class CategoriaService {
  private apiUrl = `${environment.apiUrl}/categorias`; // Ajusta la URL de tu API para categorías
  constructor(private http: HttpClient) { }
  /**
   * Obtiene todas las categorías del backend.
   * @returns Un Observable con un array de Categoria.
   */
  getCategorias(): Observable<Categoria[]> {
    return this.http.get<Categoria[]>(this.apiUrl);
  }
  /**
   * Obtiene una categoría por su ID.
   * @param id El ID de la categoría.
   * @returns Un Observable con la Categoria.
   */
getCategoria(id: number): Observable<Categoria> {
    return this.http.get<Categoria>(`${this.apiUrl}/${id}`);
  }
  /**
   * Crea una nueva categoría en el backend.
   * @param categoria La categoría a crear.
   * @returns Un Observable con la Categoria creada.
   */
  createCategoria(categoria: Categoria): Observable<Categoria> {
    return this.http.post<Categoria>(this.apiUrl, categoria);
  }
  /**
   * Actualiza una categoría existente en el backend.
   * @param id El ID de la categoría a actualizar.
   * @param categoria Los datos actualizados de la categoría.
   * @returns Un Observable con la Categoria actualizada.
   */
  updateCategoria(id: number, categoria: Categoria): Observable<Categoria> {
    return this.http.put<Categoria>(`${this.apiUrl}/${id}`, categoria);
  }
 /**
   * Elimina una categoría del backend.
   * @param id El ID de la categoría a eliminar.
   * @returns Un Observable vacío.
   */
  deleteCategoria(id: number): Observable<void> {
    return this.http.delete<void>(`${this.apiUrl}/${id}`);
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\categoria\categoria.ts -----

export interface Categoria {
  id?: number;
  nombre: string;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\Marca\marca.service.ts -----

import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { Marca } from './marca'; // Asegúrate de que la interfaz Marca esté bien definida
import { environment } from '../../../environments/environment'; // Asegúrate de la ruta correcta

@Injectable({
  providedIn: 'root' // Esto hace que el servicio esté disponible en toda la aplicación
})
export class MarcaService {
  private apiUrl = `${environment.apiUrl}/marcas`; // Ajusta la URL de tu API

  constructor(private http: HttpClient) { }

  getMarcas(): Observable<Marca[]> {
    return this.http.get<Marca[]>(this.apiUrl);
  }

  getMarca(id: number): Observable<Marca> {
    return this.http.get<Marca>(`${this.apiUrl}/${id}`);
  }

  createMarca(marca: Marca): Observable<Marca> {
    return this.http.post<Marca>(this.apiUrl, marca);
  }

  updateMarca(id: number, marca: Marca): Observable<Marca> {
    return this.http.put<Marca>(`${this.apiUrl}/${id}`, marca);
  }

  deleteMarca(id: number): Observable<void> {
    return this.http.delete<void>(`${this.apiUrl}/${id}`);
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\Marca\marca.ts -----

export interface Marca {
  id?: number;
  nombre: string;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\pedido\pedido.service.ts -----

import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { environment } from '../../../environments/environment';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class PedidoService {
  private baseUrl = environment.apiUrl + '/pedidos';

  constructor(private http: HttpClient) {}

  obtenerHistorial(): Observable<any> {
    return this.http.get<any>(this.baseUrl + '/historial');
  }

  crearPedido(pedidos: any): Observable<any> {
    return this.http.post(this.baseUrl + '/crear', pedidos);
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\pedido-request\pedido-request.ts -----

export interface PedidoRequest {
  productoId: number;
  cantidad: number;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\producto\producto.service.spec.ts -----

import { TestBed } from '@angular/core/testing';

import { ProductoService } from './producto.service';

describe('ProductoService', () => {
  let service: ProductoService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(ProductoService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\producto\producto.service.ts -----

import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Producto } from './producto';
import { environment } from '../../../environments/environment';

@Injectable({ providedIn: 'root' })
export class ProductoService {
  private baseUrl = `${environment.apiUrl}/productos`;

  constructor(private http: HttpClient) {}

  getProductos() {
    return this.http.get<Producto[]>(this.baseUrl);
  }

  getProducto(id: number) {
    return this.http.get<Producto>(`${this.baseUrl}/${id}`);
  }

  crearProducto(producto: Producto) {
    return this.http.post<Producto>(this.baseUrl, producto);
  }

  actualizarProducto(producto: Producto) {
    return this.http.put<Producto>(`${this.baseUrl}/${producto.id}`, producto);
  }

  eliminarProducto(id: number) {
    return this.http.delete(`${this.baseUrl}/${id}`);
  }

  searchProductos(keyword: string) {
    return this.http.get<Producto[]>(`${this.baseUrl}/buscar?keyword=${keyword}`);
  }

  getProductosBajoStock() {
    return this.http.get<Producto[]>(`${this.baseUrl}/bajo-stock`);
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\producto\producto.ts -----

import { Marca } from 'src/app/model/Marca/marca';
import { Categoria } from '../categoria/categoria';

export interface Producto {
  id?: number;
  nombre: string;
  descripcion: string;
  precio: number;
  stock: number;
  marca?: Marca;
  categoria?: Categoria;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\resea\resea.service.spec.ts -----

import { TestBed } from '@angular/core/testing';

import { ReseñaService } from './reseña.service';

describe('ReseñaService', () => {
  let service: ReseñaService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(ReseñaService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\resea\resea.service.ts -----

import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { Resena } from './reseña';
import { environment } from '../../../environments/environment';

@Injectable({
  providedIn: 'root'
})
export class ResenaService {
  private baseUrl = `${environment.apiUrl}/resenas`;
  http: any;


  getAllResenas(): Observable<Resena[]> {
    return this.http.get( `${this.baseUrl}/listar`);// Asumiendo que GET /reseñas lista todas
  }
  // Método para aprobar una reseña
  aprobar(id: number): Observable<string> {
    // El backend tiene PUT /reseñas/moderar/{id}
    return this.http.put(`${this.baseUrl}/moderar/${id}`, {}, { responseType: 'text' });
  }
  // Método para rechazar/eliminar una reseña (asumiendo un endpoint en el backend)
  // El backend no tiene un endpoint DELETE para reseñas en el contexto,
  // pero si se "rechaza" una reseña, a menudo se elimina.
  eliminar(id: number): Observable<string> {
    // Asumiendo un endpoint DELETE /reseñas/{id}
    return this.http.delete(`${this.baseUrl}/${id}`, { responseType: 'text' });
  }
  // Método para crear una reseña (para el COMPRADOR)
  crearResena(resena: Resena): Observable<string> {
    // El backend tiene POST /reseñas/crear
    return this.http.post(`${this.baseUrl}/crear`, resena, { responseType: 'text' });
  }
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\resea\resea.ts -----

export interface Resena {
  id?: number;
  productoId: number;
  comentario: string;
  puntuacion: number;
  aprobado?: boolean;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\usuario\usuario.service.spec.ts -----

import { TestBed } from '@angular/core/testing';

import { UsuarioService } from './usuario.service';

describe('UsuarioService', () => {
  let service: UsuarioService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(UsuarioService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\usuario\usuario.service.ts -----

import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Usuario } from './usuario';
import { environment } from '../../../environments/environment';
import { Observable } from 'rxjs';


@Injectable({ providedIn: 'root' })
export class UsuarioService {

  private baseUrl = `${environment.apiUrl}/usuario`;

  constructor(private http: HttpClient) {}

  listarUsuarios() {
    return this.http.get<Usuario[]>(`${this.baseUrl}/listar`);
  }

   crearUsuario(usuario: Usuario): Observable<String> {
       return this.http.post(`${environment.apiUrl}/admin/registro-usuario`, usuario, { responseType: 'text' });
   }

  editarUsuario(usuario: Usuario): Observable<String> {
    return this.http.put(`${this.baseUrl}/${usuario.id}`, usuario, { responseType: 'text' });
 }


  eliminarUsuario(id: number) {
    return this.http.delete(`${this.baseUrl}/${id}`, { responseType: 'text' });
  }

  asignarRol(username: string, rol: string) {
    return this.http.put(`${this.baseUrl}/${username}/rol`, { rol }); // Asegúrate de que la URL sea correcta
  }
  obtenerPerfil() {
    return this.http.get<Usuario>(`${this.baseUrl}/perfil`);
  }

  actualizarPerfil(usuario: Usuario) {
    return this.http.put(`${this.baseUrl}/perfil`, usuario);
  }

}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\model\usuario\usuario.ts -----

export interface Usuario {
  id?: number;
  username?: string;
  password?: string;
  nombre?: string;
  direccion?: string;
  telefono?: string;
  role?: string;
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\app-routing.module.ts -----

import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { AuthGuard } from './guards/auth-guard.guard';
import { AdminGuard } from './guards/admin-guard.guard';
import { CarritoComponent } from './componentes/carrito/carrito.component';
import { ProductsComponent } from './componentes/products/products.component';
import { PedidosComponent } from './componentes/pedidos/pedidos.component';
import { PerfilComponent } from './componentes/perfil/perfil.component';
import { AdminComponent } from './componentes/admin/admin.component';
import { LoginComponent } from './componentes/login/login.component';
import { RegisterComponent } from './componentes/register/register.component';

const routes: Routes = [
  { path: 'productos', component: ProductsComponent },
  { path: 'login', component: LoginComponent },
  { path: 'registro', component: RegisterComponent },
  { path: 'perfil', component: PerfilComponent, canActivate: [AuthGuard] },
  { path: 'carrito', component: CarritoComponent, canActivate: [AuthGuard] },
  { path: 'pedidos', component: PedidosComponent, canActivate: [AuthGuard] },
  { path: 'admin', component: AdminComponent, canActivate: [AdminGuard] },
  { path: '**', redirectTo: '' }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule {}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\app.component.css -----



----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\app.component.html -----

<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->
<!-- * * * * * * * * * * * The content below * * * * * * * * * * * -->
<!-- * * * * * * * * * * is only a placeholder * * * * * * * * * * -->
<!-- * * * * * * * * * * and can be replaced. * * * * * * * * * * * -->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->
<!-- * * * * * * * * * Delete the template below * * * * * * * * * * -->
<!-- * * * * * * * to get started with your project! * * * * * * * * -->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->

<style>
  :host {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    font-size: 14px;
    color: #333;
    box-sizing: border-box;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin: 8px 0;
  }

  p {
    margin: 0;
  }

  .spacer {
    flex: 1;
  }

  .toolbar {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 60px;
    display: flex;
    align-items: center;
    background-color: #1976d2;
    color: white;
    font-weight: 600;
  }

  .toolbar img {
    margin: 0 16px;
  }

  .toolbar #twitter-logo {
    height: 40px;
    margin: 0 8px;
  }

  .toolbar #youtube-logo {
    height: 40px;
    margin: 0 16px;
  }

  .toolbar #twitter-logo:hover,
  .toolbar #youtube-logo:hover {
    opacity: 0.8;
  }

  .content {
    display: flex;
    margin: 82px auto 32px;
    padding: 0 16px;
    max-width: 960px;
    flex-direction: column;
    align-items: center;
  }

  svg.material-icons {
    height: 24px;
    width: auto;
  }

  svg.material-icons:not(:last-child) {
    margin-right: 8px;
  }

  .card svg.material-icons path {
    fill: #888;
  }

  .card-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 16px;
  }

  .card {
    all: unset;
    border-radius: 4px;
    border: 1px solid #eee;
    background-color: #fafafa;
    height: 40px;
    width: 200px;
    margin: 0 8px 16px;
    padding: 16px;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    transition: all 0.2s ease-in-out;
    line-height: 24px;
  }

  .card-container .card:not(:last-child) {
    margin-right: 0;
  }

  .card.card-small {
    height: 16px;
    width: 168px;
  }

  .card-container .card:not(.highlight-card) {
    cursor: pointer;
  }

  .card-container .card:not(.highlight-card):hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 17px rgba(0, 0, 0, 0.35);
  }

  .card-container .card:not(.highlight-card):hover .material-icons path {
    fill: rgb(105, 103, 103);
  }

  .card.highlight-card {
    background-color: #1976d2;
    color: white;
    font-weight: 600;
    border: none;
    width: auto;
    min-width: 30%;
    position: relative;
  }

  .card.card.highlight-card span {
    margin-left: 60px;
  }

  svg#rocket {
    width: 80px;
    position: absolute;
    left: -10px;
    top: -24px;
  }

  svg#rocket-smoke {
    height: calc(100vh - 95px);
    position: absolute;
    top: 10px;
    right: 180px;
    z-index: -10;
  }

  a,
  a:visited,
  a:hover {
    color: #1976d2;
    text-decoration: none;
  }

  a:hover {
    color: #125699;
  }

  .terminal {
    position: relative;
    width: 80%;
    max-width: 600px;
    border-radius: 6px;
    padding-top: 45px;
    margin-top: 8px;
    overflow: hidden;
    background-color: rgb(15, 15, 16);
  }

  .terminal::before {
    content: "\2022 \2022 \2022";
    position: absolute;
    top: 0;
    left: 0;
    height: 4px;
    background: rgb(58, 58, 58);
    color: #c2c3c4;
    width: 100%;
    font-size: 2rem;
    line-height: 0;
    padding: 14px 0;
    text-indent: 4px;
  }

  .terminal pre {
    font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    color: white;
    padding: 0 1rem 1rem;
    margin: 0;
  }

  .circle-link {
    height: 40px;
    width: 40px;
    border-radius: 40px;
    margin: 8px;
    background-color: white;
    border: 1px solid #eeeeee;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
    transition: 1s ease-out;
  }

  .circle-link:hover {
    transform: translateY(-0.25rem);
    box-shadow: 0px 3px 15px rgba(0, 0, 0, 0.2);
  }

  footer {
    margin-top: 8px;
    display: flex;
    align-items: center;
    line-height: 20px;
  }

  footer a {
    display: flex;
    align-items: center;
  }

  .github-star-badge {
    color: #24292e;
    display: flex;
    align-items: center;
    font-size: 12px;
    padding: 3px 10px;
    border: 1px solid rgba(27,31,35,.2);
    border-radius: 3px;
    background-image: linear-gradient(-180deg,#fafbfc,#eff3f6 90%);
    margin-left: 4px;
    font-weight: 600;
  }

  .github-star-badge:hover {
    background-image: linear-gradient(-180deg,#f0f3f6,#e6ebf1 90%);
    border-color: rgba(27,31,35,.35);
    background-position: -.5em;
  }

  .github-star-badge .material-icons {
    height: 16px;
    width: 16px;
    margin-right: 4px;
  }

  svg#clouds {
    position: fixed;
    bottom: -160px;
    left: -230px;
    z-index: -10;
    width: 1920px;
  }

  /* Responsive Styles */
  @media screen and (max-width: 767px) {
    .card-container > *:not(.circle-link) ,
    .terminal {
      width: 100%;
    }

    .card:not(.highlight-card) {
      height: 16px;
      margin: 8px 0;
    }

    .card.highlight-card span {
      margin-left: 72px;
    }

    svg#rocket-smoke {
      right: 120px;
      transform: rotate(-5deg);
    }
  }

  @media screen and (max-width: 575px) {
    svg#rocket-smoke {
      display: none;
      visibility: hidden;
    }
  }
</style>

<!-- Toolbar -->
 <app-navbar></app-navbar>
    <!-- Aquí es donde Angular inyectará el componente de la ruta activa -->
    <div class="main-content">
      <router-outlet></router-outlet>
    </div>

  <!-- Footer -->

<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->
<!-- * * * * * * * * * * * The content above * * * * * * * * * * * -->
<!-- * * * * * * * * * * is only a placeholder * * * * * * * * * * -->
<!-- * * * * * * * * * * and can be replaced. * * * * * * * * * * * -->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->
<!-- * * * * * * * * * * End of Placeholder * * * * * * * * * * * -->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->




----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\app.component.spec.ts -----

import { TestBed } from '@angular/core/testing';
import { AppComponent } from './app.component';

describe('AppComponent', () => {
  beforeEach(() => TestBed.configureTestingModule({
    imports: [AppComponent]
  }));

  it('should create the app', () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

  it(`should have the 'app-ventas' title`, () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app.title).toEqual('app-ventas');
  });

  it('should render title', () => {
    const fixture = TestBed.createComponent(AppComponent);
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    expect(compiled.querySelector('.content span')?.textContent).toContain('app-ventas app is running!');
  });
});


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\app.component.ts -----

import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterOutlet } from '@angular/router';
import { NavbarComponent } from './layout/navbar/navbar.componet';

@Component({
  selector: 'app-root',
  standalone: true,
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css'],
  imports: [
    CommonModule,
    RouterOutlet,
    NavbarComponent
  ]
})
export class AppComponent {
  title = 'app-ventas';
  selection = { value: 'default' };
}


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\app.config.ts -----

import { ApplicationConfig, provideZoneChangeDetection} from '@angular/core';
import { routes } from './app.routes';
import { provideRouter } from '@angular/router';
import {JwtInterceptor} from  './auth/JwtInterceptor';
import {provideHttpClient, withInterceptors} from '@angular/common/http';


export const appConfig: ApplicationConfig = {
  providers: [
    provideZoneChangeDetection(),
    provideRouter(routes),
    provideHttpClient(withInterceptors([JwtInterceptor]))
  ]
};


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\app.module.ts -----

import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { HttpClientModule } from '@angular/common/http';
import { AppRoutingModule } from './app-routing.module';

import { ProductFormComponent } from './componentes/product-form/product-form.component';
import { RegisterComponent } from './componentes/register/register.component';
import { PedidosComponent } from './componentes/pedidos/pedidos.component';
import { PerfilComponent } from './componentes/perfil/perfil.component';
import { AdminComponent } from './componentes/admin/admin.component';


import { UserManagementComponent } from './componentes/user-management/user-management.component';
import { OrderManagementComponent } from './componentes/order-management/order-management.component';
import { CategoryManagementComponent } from './componentes/category-management/category-management.component';


// Agrega aquí todos tus componentes...

@NgModule({
  declarations: [



   


  ],
  imports: [
    BrowserModule,
    FormsModule,
    CommonModule,
    HttpClientModule, // Necesario para las llamadas HTTP
    AppRoutingModule
    // otros módulos como HttpClientModule, RouterModule, etc.
  ],
  providers: [],

})
export class AppModule { }


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\app\app.routes.ts -----

import { UserAdminGuard } from './guards/user.admin-guard';
import { Routes } from '@angular/router';
import { LoginComponent } from './componentes/login/login.component';
import { RegisterComponent } from './componentes/register/register.component';
import { ProductsComponent } from './componentes/products/products.component';
import { ProductFormComponent } from './componentes/product-form/product-form.component';
import { AdminComponent } from './componentes/admin/admin.component';
import { AuthGuard } from './guards/auth-guard.guard';
import { AdminGuard } from './guards/admin-guard.guard';
import { CarritoComponent } from './componentes/carrito/carrito.component';
import { PedidosComponent } from './componentes/pedidos/pedidos.component';
import { PerfilComponent } from './componentes/perfil/perfil.component';
import { UserManagementComponent } from './componentes/user-management/user-management.component';
import { OrderManagementComponent } from './componentes/order-management/order-management.component';
import { CategoryManagementComponent } from './componentes/category-management/category-management.component';
import { BrandManagementComponent } from './componentes/brand-management/brand-management.component';
import { ReviewManagementComponent } from './componentes/review-management/review-management.component';




export const routes: Routes = [
  // { path: 'login', component: LoginComponent },
  // { path: 'register', component: RegisterComponent },
  // // { path: 'register-comprador', component: RegisterCompradorComponent },

  // // Rutas para compradores
  // { path: 'products', component: ProductsComponent},
  // { path: 'carrito', component: CarritoComponent, canActivate: [AuthGuard] },
  // { path: 'pedidos', component: PedidosComponent, canActivate: [AuthGuard] },
  // { path: 'perfil', component: PerfilComponent, canActivate: [AuthGuard] },

  // // Rutas para usuarios (mantenimiento)
  // // { path: 'admin/productos', component: AdminProductosComponent, canActivate: [AuthGuard] },
  // { path: 'admin', component: AdminComponent, canActivate: [AdminGuard] },
  // { path: 'admin/productos', component: ProductFormComponent, canActivate: [UserAdminGuard] },
  // { path: 'admin/productos/nuevo', component: ProductFormComponent, canActivate: [AdminGuard] },
  // { path: 'admin/productos/editar/:id', component: ProductFormComponent, canActivate: [UserAdminGuard] },

  // // Rutas exclusivas para administradores
  // { path: 'admin/usuarios', component: UserManagementComponent, canActivate: [AdminGuard] },
  // { path: 'admin/pedidos', component: OrderManagementComponent, canActivate: [AdminGuard] },
  // { path: 'admin/categorias', component: CategoryManagementComponent, canActivate: [AdminGuard] },
  //  { path: 'admin/marcas', component: BrandManagementComponent, canActivate: [AdminGuard] },
  // { path: 'admin/resenas', component: ReviewManagementComponent, canActivate: [AdminGuard] },

  // // { path: 'admin/usuarios', component: AdminUsuariosComponent, canActivate: [AdminGuard] },
  // // { path: 'admin/registro-usuario', component: RegistroUsuarioAdminComponent, canActivate: [AdminGuard] },

  // { path: '', redirectTo: '/products', pathMatch: 'full' },
  // { path: '**', redirectTo: '/products' }
  { path: 'login', component: LoginComponent },
  { path: 'register', component: RegisterComponent },
  // Rutas públicas (accesibles por todos, incluyendo visitantes sin token)
  { path: 'products', component: ProductsComponent}, // Ya permitida en backend SecurityConfig
  // Rutas para COMPRADORES (requieren AuthGuard)
  { path: 'carrito', component: CarritoComponent, canActivate: [AuthGuard] },
  { path: 'pedidos', component: PedidosComponent, canActivate: [AuthGuard] },
  { path: 'perfil', component: PerfilComponent, canActivate: [AuthGuard] },
  // Rutas para USER y ADMIN (requieren UserAdminGuard)
  // AdminComponent es un panel general, si solo ADMIN debe verlo, usa AdminGuard
  { path: 'admin', component: AdminComponent, canActivate: [AdminGuard] }, // Solo ADMIN
  { path: 'admin/productos', component: AdminComponent, canActivate: [UserAdminGuard] }, // AdminComponent lista productos, USER y ADMIN pueden verla
  { path: 'admin/productos/create', component: ProductFormComponent, canActivate: [AdminGuard] }, // Solo ADMIN puede crear
  { path: 'admin/productos/edit/:id', component: ProductFormComponent, canActivate: [UserAdminGuard] },
   // Rutas exclusivas para ADMINISTRADORES (requieren AdminGuard)
  { path: 'admin/usuarios', component: UserManagementComponent, canActivate: [AdminGuard] },
  { path: 'admin/pedidos', component: OrderManagementComponent, canActivate: [AdminGuard] },
  { path: 'admin/categorias', component: CategoryManagementComponent, canActivate: [AdminGuard] },
  { path: 'admin/marcas', component: BrandManagementComponent, canActivate: [AdminGuard] },
  { path: 'admin/resenas', component: ReviewManagementComponent, canActivate: [UserAdminGuard] },
  { path: '', redirectTo: '/products', pathMatch: 'full' },
  { path: '**', redirectTo: '/products' }
];


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\environments\environment.ts -----

export const environment = {
  apiUrl: 'http://localhost:8080'
};


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\index.html -----

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AppVentas</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <app-root></app-root>
</body>
</html>


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\main.ts -----

import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app/app.config';
import { AppComponent } from './app/app.component';

bootstrapApplication(AppComponent, appConfig)
  .catch((err) => console.error(err));


----- ARCHIVO: D:\Universidad_UTP\Desarrollo Web Integrado\Proyectofinal\App-VentaOnline\app-ventas\src\styles.css -----

/* You can add global styles to this file, and also import other style files */
