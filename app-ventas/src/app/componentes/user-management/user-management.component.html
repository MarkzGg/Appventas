<h2>Gestión de Usuarios</h2>

<div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

<!-- Botón para crear un nuevo usuario -->
<button (click)="crearNuevoUsuario()" *ngIf="authService.isAdmin()">Crear Nuevo Usuario</button>

<!-- Formulario para crear/editar usuario -->
<div *ngIf="editandoUsuario">
  <h3>{{ editandoUsuario.id ? 'Editar Usuario' : 'Nuevo Usuario' }}</h3>
  <form (ngSubmit)="guardarUsuario()">
    <div>
      <label for="username">Usuario:</label>
      <input type="text" id="username" [(ngModel)]="editandoUsuario.username" name="username" required minlength="4" />
    </div>
    <div>
      <label for="nombre">Nombre:</label>
      <input type="text" id="nombre" [(ngModel)]="editandoUsuario.nombre" name="nombre" required />
    </div>
    <div>
      <label for="rol">Rol:</label>
      <select [(ngModel)]="editandoUsuario.role" name="rol" required>
        <option value="ADMIN">ADMIN</option>
        <option value="USER">USER</option>
        <option value="COMPRADOR">COMPRADOR</option>
        <option value="VISITANTE">VISITANTE</option>
      </select>
    </div>
    <button type="submit">{{ editandoUsuario.id ? 'Actualizar' : 'Crear' }}</button>
    <button type="button" (click)="cancelarEdicion()">Cancelar</button>
  </form>
</div>

<table *ngIf="usuarios.length > 0">
  <thead>
    <tr>
      <th>ID</th>
      <th>Usuario</th>
      <th>Nombre</th>
      <th>Rol</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let user of usuarios">
      <td>{{ user.id }}</td>
      <td>{{ user.username }}</td>
      <td>{{ user.nombre || 'N/A' }}</td>
      <td>{{ user.role || 'N/A' }}</td>
      <td>
        <button (click)="abrirModalEditarUsuario(user)" *ngIf="authService.isAdmin()">Editar</button>
        <button (click)="eliminarUsuario(user.id!)" *ngIf="authService.isAdmin()" style="background-color: #dc3545;">Eliminar</button>
        <select *ngIf="authService.isAdmin()" (change)="asignarRol(user.username!, $event)">
          <option value="">Asignar Rol</option>
          <option value="ADMIN">ADMIN</option>
          <option value="USER">USER</option>
          <option value="COMPRADOR">COMPRADOR</option>
          <option value="VISITANTE">VISITANTE</option>
        </select>
      </td>
    </tr>
  </tbody>
</table>

<p *ngIf="usuarios.length === 0">No hay usuarios registrados.</p>
